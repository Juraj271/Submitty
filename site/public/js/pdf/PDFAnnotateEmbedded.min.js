var currentTool;PDFAnnotate.default&&(PDFAnnotate=PDFAnnotate.default);var PAGE_HEIGHT,documentId="",NUM_PAGES=0;function render_student(e,t,n,o){render(e,t,"",n,1,o)}function render(e,t,n,o,a,r=""){window.GENERAL_INFORMATION={grader_id:n,user_id:t,gradeable_id:e,file_name:o},window.RENDER_OPTIONS.documentId=o,window.RENDER_OPTIONS.userId=n,""===r&&(r=buildCourseUrl(["gradeable",e,"encode_pdf"])),$.ajax({type:"POST",url:r,data:{user_id:t,filename:o,csrf_token:csrfToken},success:e=>{let t;PDFAnnotate.setStoreAdapter(new PDFAnnotate.LocalUserStoreAdapter(GENERAL_INFORMATION.grader_id));try{t=JSON.parse(e).data,t=atob(t)}catch(e){alert("Something went wrong, please try again later.")}pdfjsLib.getDocument({data:t,cMapUrl:"../../vendor/pdfjs/cmaps/",cMapPacked:!0}).then(e=>{window.RENDER_OPTIONS.pdfDocument=e;let t=document.getElementById("viewer");$(t).on("touchstart touchmove",function(e){"pen"!=currentTool&&"text"!=currentTool||e.preventDefault()}),$("a[value='zoomcustom']").text(parseInt(100*window.RENDER_OPTIONS.scale)+"%"),t.innerHTML="",NUM_PAGES=e.numPages;for(let e=0;e<NUM_PAGES;e++){let n=PDFAnnotate.UI.createPage(e+1);t.appendChild(n);let o=e+1;PDFAnnotate.UI.renderPage(o,window.RENDER_OPTIONS).then(function(){if(e==a){let e=$("#pageContainer"+o);e.length&&$("#file_content").animate({scrollTop:e[0].offsetTop},500)}document.getElementById("pageContainer"+o).addEventListener("pointerdown",function(){let e=$(".tool-selected");0!=e.length&&"cursor"!=$(e[0]).attr("value")&&($("#save_status").text("Changes not saved"),$("#save_status").css("color","red"))})})}})}})}window.RENDER_OPTIONS={documentId:documentId,userId:"",pdfDocument:null,scale:parseFloat(localStorage.getItem("scale"))||1,rotate:parseInt(localStorage.getItem("rotate"))||0},window.GENERAL_INFORMATION={grader_id:"",user_id:"",gradeable_id:"",file_name:""},pdfjsLib.GlobalWorkerOptions.workerSrc="vendor/pdfjs/pdf.worker.min.js",$(window).on("unload",()=>{for(let e=0;e<localStorage.length;e++)localStorage.key(e).includes("annotations")&&localStorage.removeItem(localStorage.key(e))});