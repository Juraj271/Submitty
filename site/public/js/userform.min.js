function newStudentForm(){$('[name="user_group"] option[value="4"]').prop("selected",!0),$("#user-form-assigned-sections").hide(),$("#user-form-student-error-message").show(),$("#new-student-modal-title").css("display","block"),$("#new-grader-modal-title").css("display","none"),newUserForm()}function newGraderForm(){$('[name="user_group"] option[value="3"]').prop("selected",!0),$("#user-form-student-error-message").hide(),$("#user-form-assigned-sections").show(),$("#new-student-modal-title").css("display","none"),$("#new-grader-modal-title").css("display","block"),newUserForm()}function newUserForm(){$(".popup-form").css("display","none");var e=$("#edit-user-form");e.css("display","block"),$("#edit-student-modal-title").css("display","none"),$("#edit-grader-modal-title").css("display","none"),$("#user-form-already-exists-error-message").css("display","none"),$('[name="edit_user"]',e).val("false"),$('[name="user_id"]',e).removeClass("readonly").prop("readonly",!1),$('[name="manual_registration"]',e).prop("checked",!0),""==$("#user_id").val()&&$("#user_id")[0].setCustomValidity("user_id is required"),""==$("#user_firstname").val()&&$("#user_firstname")[0].setCustomValidity("user_firstname is required"),""==$("#user_lastname").val()&&$("#user_lastname")[0].setCustomValidity("user_lastname is required"),checkValidEntries()}function editUserForm(e){var r=buildCourseUrl(["users","details"])+`?user_id=${e}`;$.ajax({url:r,success:function(e){var r=JSON.parse(e).data,s=$("#edit-user-form");s.css("display","block"),4==r.user_group?($("#edit-student-modal-title").css("display","block"),$("#edit-grader-modal-title").css("display","none")):($("#edit-student-modal-title").css("display","none"),$("#edit-grader-modal-title").css("display","block")),$("#new-student-modal-title").css("display","none"),$("#new-grader-modal-title").css("display","none"),$("#user-form-already-exists-error-message").css("display","none"),$('[name="edit_user"]',s).val("true");var a=$('[name="user_id"]',s);a.val(r.user_id),a.attr("readonly","readonly"),a.hasClass("readonly")||a.addClass("readonly"),completeUserFormInformation(r),clearValidityWarnings()},error:function(){alert("Could not load user data, please refresh the page and try again.")}})}function userFormChange(){var e=$("select[name='user_group']")[0],r="Student"===e.options[e.selectedIndex].text,s=$("select[name='registered_section']")[0],a="Not Registered"===s.options[s.selectedIndex].text;r&&a?$("#user-form-student-error-message").show():$("#user-form-student-error-message").hide(),r?$("#user-form-assigned-sections").hide():$("#user-form-assigned-sections").show()}function checkValidEntries(){$("#edit-user-form");var e=$(this);switch(e.prop("id")){case"user_id":if(""==e.val()){e[0].setCustomValidity(e.prop("id")+" is required");break}if(!$("#user-form-already-exists-error-message").is(":hidden")){e[0].setCustomValidity(e.prop("id")+" already exists");break}setRedOrTransparent(e,/^[a-z0-9_\-]*$/);break;case"user_numeric_id":break;case"user_firstname":case"user_lastname":if(""==e.val()){e[0].setCustomValidity(e.prop("id")+" is required");break}setRedOrTransparent(e,/^[a-zA-Z'`\-\.\(\) ]*$/);break;case"user_preferred_firstname":case"user_preferred_lastname":setRedOrTransparent(e,/^[a-zA-Z'`\-\.\(\) ]{0,30}$/);break;case"user_email":if(""==e.val()){e.css("background-color","transparent");break}setRedOrTransparent(e,/^[^(),:;\<\>@\\"\[\]]+@(?!\-)[a-zA-Z0-9\-]+(?!\-)(\.[a-zA-Z0-9]+)+$/)}var r=!1;$(":text",$("#edit-user-form")).each(function(){this.checkValidity()||(r=!0)}),r?$("#user-form-submit").prop("disabled",!0):$("#user-form-submit").prop("disabled",!1)}function setRedOrTransparent(e,r){r.test(e.val())?e[0].setCustomValidity(""):e[0].setCustomValidity(e.val()+" is not a valid "+e.prop("id"))}function autoCompleteOnUserId(e){if($("#edit-user-form"),$("#user_id").val()in e){var r=e[$("#user_id").val()],s=r.already_in_course?"block":"none";$("#user-form-already-exists-error-message").css("display",s),completeUserFormInformation(r)}else $("#user-form-already-exists-error-message").css("display","none")}function completeUserFormInformation(e){var r,s,a=$("#edit-user-form");$('[name="user_numeric_id"]',a).val(e.user_numeric_id),$('[name="user_firstname"]',a).val(e.user_firstname),$('[name="user_firstname"]').change(),$('[name="user_preferred_firstname"]',a).val(e.user_preferred_firstname),$('[name="user_preferred_firstname"]').change(),$('[name="user_lastname"]',a).val(e.user_lastname),$('[name="user_lastname"]').change(),$('[name="user_preferred_lastname"]',a).val(e.user_preferred_lastname),$('[name="user_preferred_lastname"]').change(),$('[name="user_email"]',a).val(e.user_email),$('[name="user_email"]').change(),r=null===e.registration_section?"null":e.registration_section.toString(),s=null===e.rotating_section?"null":e.rotating_section.toString(),$('[name="registered_section"] option[value="'+r+'"]',a).prop("selected",!0),$('[name="rotating_section"] option[value="'+s+'"]',a).prop("selected",!0),e.already_in_course&&($('[name="user_group"] option[value="'+e.user_group+'"]',a).prop("selected",!0),$('[name="manual_registration"]',a).prop("checked",e.manual_registration)),$("[name='grading_registration_section[]']").prop("checked",!1),null!==e.grading_registration_sections&&void 0!==e.grading_registration_sections&&e.grading_registration_sections.forEach(function(e){$("#grs_"+e).prop("checked",!0)}),"null"===r&&$('[name="user_group"] option[value="4"]',a).prop("selected")?$("#user-form-student-error-message").css("display","block"):$("#user-form-student-error-message").css("display","none"),$('[name="user_group"] option[value="4"]',a).prop("selected")?$("#user-form-assigned-sections").hide():$("#user-form-assigned-sections").show()}function clearUserFormInformation(){var e=$("#edit-user-form");$('[name="user_numeric_id"]',e).val(""),$('[name="user_firstname"]',e).val(""),$('[name="user_preferred_firstname"]',e).val(""),$('[name="user_lastname"]',e).val(""),$('[name="user_preferred_lastname"]',e).val(""),$('[name="user_email"]',e).val(""),$('[name="registered_section"] option[value="null"]',e).prop("selected",!0),$('[name="rotating_section"] option[value="null"]',e).prop("selected",!0),$('[name="manual_registration"]',e).prop("checked",!0),$("[name='grading_registration_section[]']").prop("checked",!1),clearValidityWarnings()}function clearValidityWarnings(){$(":text",$("#edit-user-form")).each(function(){$(this)[0].setCustomValidity("")}),$("#user-form-submit").prop("disabled",!1)}function closeButton(){$("#edit-user-form").css("display","none"),"true"==$('[name="edit_user"]').val()&&($('[name="user_id"]',$("#edit-user-form")).val(""),clearUserFormInformation())}function redirectToEdit(){editUserForm($("#user_id").val())}$("#edit-user-form").ready(function(){var e=$("#edit-user-form"),r=buildCourseUrl(["user_information"]);$.ajax({url:r,success:function(r){var s=JSON.parse(r).data;$('[name="user_id"]').change(function(){autoCompleteOnUserId(s)}),$('[name="user_id"]',e).autocomplete({source:Object.keys(s)}),$('[name="user_id"]',e).autocomplete("option","appendTo",e),$(":text",$("#edit-user-form")).change(checkValidEntries)},error:function(){alert("Could not load user data, please refresh the page and try again.")}})});