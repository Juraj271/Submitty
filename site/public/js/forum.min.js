function categoriesFormEvents(){$("#ui-category-list").sortable({items:".category-sortable",handle:".handle",update:function(e,t){reorderCategories()}}),$("#ui-category-list").find(".fa-edit").click(function(){var e=$(this).parent().parent().parent(),t=e.find(".categorylistitem-desc span").text().trim();e.find(".categorylistitem-editdesc input").val(t),e.find(".categorylistitem-desc").hide(),e.find(".categorylistitem-editdesc").show()}),$("#ui-category-list").find(".fa-times").click(function(){var e=$(this).parent().parent().parent();e.find(".categorylistitem-editdesc").hide(),e.find(".categorylistitem-desc").show()}),$(".category-color-picker").each(function(){var e;e=$(this),$(e).css("background-color",$(e).val())})}function openFileForum(e,t,a){var r=buildCourseUrl(["display_file"])+"?dir="+e+"&file="+t+"&path="+a;window.open(r,"_blank","toolbar=no,scrollbars=yes,resizable=yes, width=700, height=600")}function checkForumFileExtensions(e){for(var t=0,a=0;a<e.length;a++){var r=getFileExtension(e[a].name);"gif"!=r&&"png"!=r&&"jpg"!=r&&"jpeg"!=r&&"bmp"!=r||t++}return t==e.length}function resetForumFileUploadAfterError(e){$("#file_name"+e).html(""),document.getElementById("file_input_label"+e).style.border="2px solid red",document.getElementById("file_input"+e).value=null}function checkNumFilesForumUpload(e,t){var a=void 0!==t?"_"+escapeSpecialChars(t):"";if(e.files.length>5)displayError("Max file upload size is 5. Please try again."),resetForumFileUploadAfterError(a);else{if(!checkForumFileExtensions(e.files))return displayError("Invalid file type. Please upload only image files. (PNG, JPG, GIF, BMP...)"),void resetForumFileUploadAfterError(a);$("#file_name"+a).html('<p style="display:inline-block;">'+e.files.length+" files selected.</p>"),$("#messages").fadeOut(),document.getElementById("file_input_label"+a).style.border=""}}function testAndGetAttachments(e,t){for(var a=e-1,r=[],s=0;s<file_array[a].length;s++){if(-1!=file_array[a][s].name.indexOf("'")||-1!=file_array[a][s].name.indexOf('"'))return alert("ERROR! You may not use quotes in your filename: "+file_array[a][s].name),!1;if(-1!=file_array[a][s].name.indexOf("\\\\")||-1!=file_array[a][s].name.indexOf("/"))return alert("ERROR! You may not use a slash in your filename: "+file_array[a][s].name),!1;if(-1!=file_array[a][s].name.indexOf("<")||-1!=file_array[a][s].name.indexOf(">"))return alert("ERROR! You may not use angle brackets in your filename: "+file_array[a][s].name),!1;r.push(file_array[a][s])}return r.length>5?(t?displayError("Max file upload size is 5. Please remove attachments accordingly."):displayError("Max file upload size is 5. Please try again."),!1):checkForumFileExtensions(r)?r:(displayError("Invalid file type. Please upload only image files. (PNG, JPG, GIF, BMP...)"),!1)}function publishFormWithAttachments(e,t,a){if(!e[0].checkValidity())return e[0].reportValidity(),!1;if(t&&!e.prop("ignore-cat")&&0==e.find(".cat-selected").length&&0==$(".cat-buttons input").is(":checked"))return alert("At least one category must be selected."),!1;var r=e.find(".thread-post-form").attr("post_box_id"),s=new FormData(e[0]),i=testAndGetAttachments(r,!1);if(!1===i)return!1;for(var o=0;o<i.length;o++)s.append("file_input[]",i[o],i[o].name);var n=e.attr("action");return $.ajax({url:n,data:s,processData:!1,contentType:!1,type:"POST",success:function(e){try{var t=JSON.parse(e);if("fail"===t.status){var a='<div class="inner-message alert alert-error" style="position: fixed;top: 40px;left: 50%;width: 40%;margin-left: -20%;" id="theid"><a class="fas fa-times message-close" onClick="removeMessagePopup(\'theid\');"></a><i class="fas fa-times-circle"></i>'+t.message+"</div>";return void $("#messages").append(a)}}catch(e){return a='<div class="inner-message alert alert-error" style="position: fixed;top: 40px;left: 50%;width: 40%;margin-left: -20%;" id="theid"><a class="fas fa-times message-close" onClick="removeMessagePopup(\'theid\');"></a><i class="fas fa-times-circle"></i>Error parsing data. Please try again.</div>',void $("#messages").append(a)}window.location.href=t.data.next_page},error:function(){var e='<div class="inner-message alert alert-error" style="position: fixed;top: 40px;left: 50%;width: 40%;margin-left: -20%;" id="theid"><a class="fas fa-times message-close" onClick="removeMessagePopup(\'theid\');"></a><i class="fas fa-times-circle"></i>'+a+"</div>";$("#messages").append(e)}}),!1}function createThread(e){e.preventDefault();try{return publishFormWithAttachments($(this),!0,"Something went wrong while creating thread. Please try again.")}catch(e){return console.error(e),alert("Something went wrong. Please try again."),!1}}function publishPost(e){e.preventDefault();try{return publishFormWithAttachments($(this),!1,"Something went wrong while publishing post. Please try again.")}catch(e){return console.error(e),alert("Something went wrong. Please try again."),!1}}function changeThreadStatus(e){var t=buildCourseUrl(["forum","threads","status"])+"?status=1";$.ajax({url:t,type:"POST",data:{thread_id:e,csrf_token:csrfToken},success:function(e){try{var t=JSON.parse(e)}catch(e){var a='<div class="inner-message alert alert-error" style="position: fixed;top: 40px;left: 50%;width: 40%;margin-left: -20%;" id="theid"><a class="fas fa-times message-close" onClick="removeMessagePopup(\'theid\');"></a><i class="fas fa-times-circle"></i>Error parsing data. Please try again.</div>';return void $("#messages").append(a)}if("fail"!==t.status)window.location.reload(),a='<div class="inner-message alert alert-success" style="position: fixed;top: 40px;left: 50%;width: 40%;margin-left: -20%;" id="theid"><a class="fas fa-times message-close" onClick="removeMessagePopup(\'theid\');"></a><i class="fas fa-check-circle"></i>Thread marked as resolved.</div>',$("#messages").append(a);else{a='<div class="inner-message alert alert-error" style="position: fixed;top: 40px;left: 50%;width: 40%;margin-left: -20%;" id="theid"><a class="fas fa-times message-close" onClick="removeMessagePopup(\'theid\');"></a><i class="fas fa-times-circle"></i>'+t.message+"</div>";$("#messages").append(a)}},error:function(){window.alert("Something went wrong when trying to mark this thread as resolved. Please try again.")}})}function editPost(e,t,a,r,s){if(checkAreYouSureForm()){var i=$("#thread_form"),o=buildCourseUrl(["forum","posts","get"]);$.ajax({url:o,type:"POST",data:{post_id:e,thread_id:t,render_markdown:r,csrf_token:s},success:function(r){try{var s=JSON.parse(r)}catch(e){var o='<div class="inner-message alert alert-error" style="position: fixed;top: 40px;left: 50%;width: 40%;margin-left: -20%;" id="theid"><a class="fas fa-times message-close" onClick="removeMessagePopup(\'theid\');"></a><i class="fas fa-times-circle"></i>Error parsing data. Please try again.</div>';return void $("#messages").append(o)}if("fail"!==s.status){var n=(s=s.data).post,l=n.split(/\r|\r\n|\n/).length,c=s.anon,d=s.change_anon,u=escapeSpecialChars(s.user),p=Date.parse(s.post_time);p||(p=Date.parse(s.post_time+":00")),p=new Date(p);var f=s.categories_ids,h=p.toLocaleDateString();p=p.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0});var m=i.find("[name=thread_post_content]")[0];if(m.style.height=14*l,document.getElementById("edit_user_prompt").innerHTML="Editing a post by: "+u+" on "+h+" at "+p,m.value=n,document.getElementById("edit_post_id").value=e,document.getElementById("edit_thread_id").value=t,d?$("#thread_post_anon_edit").prop("checked",c):($("label[for=Anon]").remove(),$("#thread_post_anon_edit").remove()),$("#edit-user-post").css("display","block"),$(".cat-buttons input").prop("checked",!1),!0===s.markdown?($("#markdown_input_").val("1"),$("#markdown_toggle_").addClass("markdown-active"),$("#markdown_buttons_").show()):($("#markdown_input_").val("0"),$("#markdown_toggle_").removeClass("markdown-active"),$("#markdown_buttons_").hide()),a){var g=s.title,y=s.lock_thread_date,v=s.thread_status;$("#title").prop("disabled",!1),$(".edit_thread").show(),$("#label_lock_thread").show(),$("#title").val(g),$("#thread_status").val(v),$("#lock_thread_date").val(y),$(".cat-buttons").removeClass("cat-selected"),$.each(f,function(e,t){var a=$(".cat-buttons input[value="+t+"]");a.prop("checked",!0),a.parent().addClass("cat-selected")}),$(".cat-buttons").trigger("eventChangeCatClass"),$("#thread_form").prop("ignore-cat",!1),$("#category-selection-container").show(),$("#thread_status").show()}else $("#title").prop("disabled",!0),$(".edit_thread").hide(),$("#label_lock_thread").hide(),$("#thread_form").prop("ignore-cat",!0),$("#category-selection-container").hide(),$("#thread_status").hide()}else o='<div class="inner-message alert alert-error" style="position: fixed;top: 40px;left: 50%;width: 40%;margin-left: -20%;" id="theid"><a class="fas fa-times message-close" onClick="removeMessagePopup(\'theid\');"></a><i class="fas fa-times-circle"></i>'+s.message+"</div>",$("#messages").append(o)},error:function(){window.alert("Something went wrong while trying to edit the post. Please try again.")}})}}function changeDisplayOptions(e){thread_id=$("#current-thread").val(),document.cookie="forum_display_option="+e+";",window.location.replace(buildCourseUrl(["forum","threads",thread_id])+`?option=${e}`)}function readCategoryValues(){var e=[];return $("#thread_category button").each(function(){"true"===$(this).attr("btn-selected")&&e.push($(this).attr("cat-id"))}),e}function readThreadStatusValues(){var e=[];return $("#thread_status_select button").each(function(){"true"===$(this).attr("btn-selected")&&e.push($(this).attr("sel-id"))}),e}function dynamicScrollLoadPage(e,t){var a,r,s=$(e).attr(t?"next_page":"prev_page");if(0==s)return!1;if($(e).data("dynamic_lock_load"))return null;var i=$(e).find(".fa-caret-up"),o=$(e).find(".fa-caret-down"),n=i.prev(),l=o.next();$(e).data("dynamic_lock_load",!0),t?(o.hide(),l.show(),a=function(t,a){l.hide(),o.before(t),0==a?$(e).attr("next_page",0):($(e).attr("next_page",parseInt(s)+1),o.show()),dynamicScrollLoadIfScrollVisible($(e))},r=function(e,t){l.hide()}):(i.hide(),n.show(),a=function(t,a){if(n.hide(),i.after(t),0==a)$(e).attr("prev_page",0);else{var r=parseInt(s)-1;$(e).attr("prev_page",r),r>=1&&i.show()}dynamicScrollLoadIfScrollVisible($(e))},r=function(e,t){n.hide()});var c=$(e).data("urlPattern"),d=$(e).data("currentThreadId"),u=$(e).data("currentCategoriesId"),p=($(e).data("course"),c.replace("{{#}}",s)),f=readCategoryValues(),h=readThreadStatusValues(),m=$("#unread").is(":checked");return f=null==f?"":f.join("|"),h=null==h?"":h.join("|"),$.ajax({url:p,type:"POST",data:{thread_categories:f,thread_status:h,unread_select:m,currentThreadId:d,currentCategoriesId:u,csrf_token:window.csrfToken},success:function(t){var r=JSON.parse(t).data,s=r.html,i=r.count;s=`${s}`,$(e).data("dynamic_lock_load",!1),a(s,i)},error:function(){$(e).data("dynamic_lock_load",!1),r(),window.alert("Something went wrong while trying to load more threads. Please try again.")}}),!0}function dynamicScrollLoadIfScrollVisible(e){e[0].scrollHeight<=e[0].clientHeight&&!1===dynamicScrollLoadPage(e[0],!0)&&dynamicScrollLoadPage(e[0],!1)}function dynamicScrollContentOnDemand(e,t,a,r,s){e.data("urlPattern",t),e.data("currentThreadId",a),e.data("currentCategoriesId",r),e.data("course",s),dynamicScrollLoadIfScrollVisible(e),$(e).scroll(function(){var e=$(this)[0],t=e.scrollTop<2,a=e.scrollHeight-e.offsetHeight-e.scrollTop<2;t?(e.scrollTop=2,dynamicScrollLoadPage(e,!1)):a&&dynamicScrollLoadPage(e,!0)})}function resetScrollPosition(e){0!=sessionStorage.getItem(e+"_scrollTop")&&sessionStorage.setItem(e+"_scrollTop",0)}function saveScrollLocationOnRefresh(e){var t=document.getElementById(e);$(t).scroll(function(){sessionStorage.setItem(e+"_scrollTop",$(t).scrollTop())}),$(document).ready(function(){null!==sessionStorage.getItem(e+"_scrollTop")&&$(t).scrollTop(sessionStorage.getItem(e+"_scrollTop"))})}function checkAreYouSureForm(){var e=$("form");return!e.hasClass("dirty")||!!confirm("You have unsaved changes! Do you want to continue?")&&(e.trigger("reinitialize.areYouSure"),!0)}function alterShowDeletedStatus(e){checkAreYouSureForm()&&(document.cookie="show_deleted="+e+"; path=/;",location.reload())}function alterShowMergeThreadStatus(e,t){checkAreYouSureForm()&&(document.cookie=t+"_show_merged_thread="+e+"; path=/;",location.reload())}function modifyThreadList(e,t,a,r,s){var i=readCategoryValues(),o=readThreadStatusValues(),n=$("#unread").is(":checked");i=null==i?"":i.join("|"),o=null==o?"":o.join("|"),document.cookie=a+"_forum_categories="+i+";",document.cookie="forum_thread_status="+o+";",document.cookie="unread_select_value="+n+";";var l=buildCourseUrl(["forum","threads"])+`?page_number=${r?"1":"-1"}`;$.ajax({url:l,type:"POST",data:{thread_categories:i,thread_status:o,unread_select:n,currentThreadId:e,currentCategoriesId:t,csrf_token:csrfToken},success:function(e){var t=JSON.parse(e).data,a=parseInt(t.page_number),i=parseInt(t.count);t=`${t=t.html}`;var o=$("#thread_list");o.children(":not(.fas)").remove(),$("#thread_list .fa-caret-up").after(t),o.attr("prev_page",a-1),o.attr("next_page",a+1),o.data("dynamic_lock_load",!1),$("#thread_list .fa-spinner").hide(),r?($("#thread_list .fa-caret-up").hide(),$("#thread_list .fa-caret-down").show()):($("#thread_list .fa-caret-up").show(),$("#thread_list .fa-caret-down").hide()),$("#num_filtered").text(i),dynamicScrollLoadIfScrollVisible(o),loadThreadHandler(),null!=s&&s()},error:function(){window.alert("Something went wrong when trying to filter. Please try again."),document.cookie=a+"_forum_categories=;",document.cookie="forum_thread_status=;"}})}function replyPost(e){"block"==$("#"+e+"-reply").css("display")?$("#"+e+"-reply").css("display","none"):(hideReplies(),$("#"+e+"-reply").css("display","block"))}function generateCodeMirrorBlocks(e){var t=e.querySelectorAll(".code");for(let e of t){var a=CodeMirror.fromTextArea(e,{lineNumbers:!0,readOnly:!0,cursorHeight:0,lineWrapping:!0}),r=a.lineCount();if(1==r)a.setSize("100%",2*a.defaultTextHeight()+"px");else{var s=a.defaultTextHeight()*r+15;a.setSize("100%",(s>500?500:s)+"px")}a.setOption("theme","eclipse"),a.refresh()}}function showHistory(e){var t=buildCourseUrl(["forum","posts","history"]);$.ajax({url:t,type:"POST",data:{post_id:e,csrf_token:csrfToken},success:function(e){try{var t=JSON.parse(e)}catch(e){var a='<div class="inner-message alert alert-error" style="position: fixed;top: 40px;left: 50%;width: 40%;margin-left: -20%;" id="theid"><a class="fas fa-times message-close" onClick="removeMessagePopup(\'theid\');"></a><i class="fas fa-times-circle"></i>Error parsing data. Please try again.</div>';return void $("#messages").append(a)}if("fail"!==t.status){$("#popup-post-history").show(),$("#popup-post-history .post_box.history_box").remove(),$("#popup-post-history .form-body").css("padding","5px");for(var r=$($("#popup-post-history .post_box")[0]),s=(t=t.data).length-1;s>=0;s-=1){var i=t[s];box=r.clone(),box.show(),box.addClass("history_box"),box.find(".post_content").html(i.content),i.is_staff_post&&box.addClass("important");var o=i.user_info.first_name.trim(),n=i.user_info.last_name.trim(),l=i.user,c=o+" "+(0==n.length?"":n.substr(0,1)+"."),d=o+" "+n+" ("+l+")",u=JSON.stringify(c),p="<a style='margin-right:2px;display:inline-block; color:black;' onClick='changeName(this.parentNode, "+(d=JSON.stringify(d))+", "+u+", false)' title='Show full user information'><i class='fas fa-eye' aria-hidden='true'></i></a>&nbsp;";box.find("h7").html("<strong>"+c+"</strong> "+i.post_time),box.find("h7").before(p),$("#popup-post-history .form-body").prepend(box)}generateCodeMirrorBlocks($("#popup-post-history")[0])}else a='<div class="inner-message alert alert-error" style="position: fixed;top: 40px;left: 50%;width: 40%;margin-left: -20%;" id="theid"><a class="fas fa-times message-close" onClick="removeMessagePopup(\'theid\');"></a><i class="fas fa-times-circle"></i>'+t.message+"</div>",$("#messages").append(a)},error:function(){window.alert("Something went wrong while trying to display post history. Please try again.")}})}function addNewCategory(e){var t=$("#new_category_text").val(),a=buildCourseUrl(["forum","categories","new"]);$.ajax({url:a,type:"POST",data:{newCategory:t,csrf_token:e},success:function(e){try{var a=JSON.parse(e)}catch(e){var r='<div class="inner-message alert alert-error" style="position: fixed;top: 40px;left: 50%;width: 40%;margin-left: -20%;" id="theid"><a class="fas fa-times message-close" onClick="removeMessagePopup(\'theid\');"></a><i class="fas fa-times-circle"></i>Error parsing data. Please try again.</div>';return void $("#messages").append(r)}if("fail"!==a.status){r='<div class="inner-message alert alert-success" style="position: fixed;top: 40px;left: 50%;width: 40%;margin-left: -20%;" id="theid"><a class="fas fa-times message-close" onClick="removeMessagePopup(\'theid\');"></a><i class="fas fa-check-circle"></i>Successfully created category "'+escapeSpecialChars(t)+'".</div>',$("#messages").append(r),$("#new_category_text").val("");var s=a.data.new_id,i=escapeSpecialChars(t);newelement=$($("#ui-category-list li")[0]).clone(!0),newelement.attr("id","categorylistitem-"+s),newelement.css("color","#000080"),newelement.find(".categorylistitem-desc span").text(i),newelement.find(".category-color-picker").val("#000080"),newelement.show(),newelement.addClass("category-sortable"),newcatcolorpicker=newelement.find(".category-color-picker"),newcatcolorpicker.css("background-color",newcatcolorpicker.val()),$("#ui-category-list").append(newelement),$(".category-list-no-element").hide(),refreshCategories()}else{r='<div class="inner-message alert alert-error" style="position: fixed;top: 40px;left: 50%;width: 40%;margin-left: -20%;" id="theid"><a class="fas fa-times message-close" onClick="removeMessagePopup(\'theid\');"></a><i class="fas fa-times-circle"></i>'+a.message+"</div>";$("#messages").append(r)}},error:function(){window.alert("Something went wrong while trying to add a new category. Please try again.")}})}function deleteCategory(e,t,a){var r=buildCourseUrl(["forum","categories","delete"]);$.ajax({url:r,type:"POST",data:{deleteCategory:e,csrf_token:a},success:function(a){try{var r=JSON.parse(a)}catch(e){var s='<div class="inner-message alert alert-error" style="position: fixed;top: 40px;left: 50%;width: 40%;margin-left: -20%;" id="theid"><a class="fas fa-times message-close" onClick="removeMessagePopup(\'theid\');"></a><i class="fas fa-times-circle"></i>Error parsing data. Please try again.</div>';return void $("#messages").append(s)}if("fail"!==r.status)s='<div class="inner-message alert alert-success" style="position: fixed;top: 40px;left: 50%;width: 40%;margin-left: -20%;" id="theid"><a class="fas fa-times message-close" onClick="removeMessagePopup(\'theid\');"></a><i class="fas fa-check-circle"></i>Successfully deleted category "'+escapeSpecialChars(t)+'"</div>',$("#messages").append(s),$("#categorylistitem-"+e).remove(),refreshCategories();else{s='<div class="inner-message alert alert-error" style="position: fixed;top: 40px;left: 50%;width: 40%;margin-left: -20%;" id="theid"><a class="fas fa-times message-close" onClick="removeMessagePopup(\'theid\');"></a><i class="fas fa-times-circle"></i>'+r.message+"</div>";$("#messages").append(s)}},error:function(){window.alert("Something went wrong while trying to add a new category. Please try again.")}})}function editCategory(e,t,a,r){if(null!==t||null!==a){var s={category_id:e,csrf_token:r};null!==t&&(s.category_desc=t),null!==a&&(s.category_color=a);var i=buildCourseUrl(["forum","categories","edit"]);$.ajax({url:i,type:"POST",data:s,success:function(r){try{var s=JSON.parse(r)}catch(e){var i='<div class="inner-message alert alert-error" style="position: fixed;top: 40px;left: 50%;width: 40%;margin-left: -20%;" id="theid"><a class="fas fa-times message-close" onClick="removeMessagePopup(\'theid\');"></a><i class="fas fa-times-circle"></i>Error parsing data. Please try again.</div>';return void $("#messages").append(i)}if("fail"!==s.status)i='<div class="inner-message alert alert-success" style="position: fixed;top: 40px;left: 50%;width: 40%;margin-left: -20%;" id="theid"><a class="fas fa-times message-close" onClick="removeMessagePopup(\'theid\');"></a><i class="fas fa-check-circle"></i>Successfully updated!</div>',$("#messages").append(i),setTimeout(function(){removeMessagePopup("theid")},1e3),null!==a&&$("#categorylistitem-"+e).css("color",a),null!==t&&$("#categorylistitem-"+e).find(".categorylistitem-desc span").text(t),refreshCategories();else{i='<div class="inner-message alert alert-error" style="position: fixed;top: 40px;left: 50%;width: 40%;margin-left: -20%;" id="theid"><a class="fas fa-times message-close" onClick="removeMessagePopup(\'theid\');"></a><i class="fas fa-times-circle"></i>'+s.message+"</div>";$("#messages").append(i)}},error:function(){window.alert("Something went wrong while trying to add a new category. Please try again.")}})}}function refreshCategories(){if($("#ui-category-list").length){var e=$("#ui-category-list").sortable("serialize");if(!e.trim())return;e=e.split("&");for(var t=[],a=0;a<e.length;a+=1){var r=parseInt(e[a].split("=")[1]),s=$("#categorylistitem-"+r+" .categorylistitem-desc span").text().trim(),i=$("#categorylistitem-"+r+" select").val();t.push([r,s,i])}var o=new Set,n=$(".cat-buttons");for(a=0;a<n.length;a+=1){var l=$(n[a]).find("input");r=parseInt(l.val()),l.prop("checked")&&o.add(r)}$("#categories-pick-list").empty(),t.forEach(function(e){var t=e[0],a=e[1],r=e[2],s="";o.has(t)&&(s="btn-selected");var i=' <a class="btn cat-buttons '+s+'" data-color="'+r+'">'+a+'                                <input type="checkbox" name="cat[]" value="'+t+'">                            </a>';$("#categories-pick-list").append(i)}),$(".cat-buttons input[type='checkbox']").each(function(){$(this).parent().hasClass("btn-selected")&&$(this).prop("checked",!0)})}$("a.cat-buttons input").hide(),$(".cat-buttons").click(function(){$(this).hasClass("btn-selected")?($(this).removeClass("btn-selected"),$(this).find("input[type='checkbox']").prop("checked",!1)):($(this).addClass("btn-selected"),$(this).find("input[type='checkbox']").prop("checked",!0)),$(this).trigger("eventChangeCatClass")}),$(".cat-buttons").bind("eventChangeCatClass",changeColorClass),$(".cat-buttons").trigger("eventChangeCatClass")}function changeColorClass(){var e=$(this).data("color");$(this).css("border-color",e),$(this).hasClass("btn-selected")?($(this).css("background-color",e),$(this).css("color","white")):($(this).css("background-color","white"),$(this).css("color",e))}function reorderCategories(e){var t=$("#ui-category-list").sortable("serialize");t+="&csrf_token="+e;var a=buildCourseUrl(["forum","categories","reorder"]);$.ajax({url:a,type:"POST",data:t,success:function(e){try{var t=JSON.parse(e)}catch(e){var a='<div class="inner-message alert alert-error" style="position: fixed;top: 40px;left: 50%;width: 40%;margin-left: -20%;" id="theid"><a class="fas fa-times message-close" onClick="removeMessagePopup(\'theid\');"></a><i class="fas fa-times-circle"></i>Error parsing data. Please try again.</div>';return void $("#messages").append(a)}if("fail"!==t.status)a='<div class="inner-message alert alert-success" style="position: fixed;top: 40px;left: 50%;width: 40%;margin-left: -20%;" id="theid"><a class="fas fa-times message-close" onClick="removeMessagePopup(\'theid\');"></a><i class="fas fa-check-circle"></i>Successfully reordered categories.',$("#messages").append(a),setTimeout(function(){removeMessagePopup("theid")},1e3),refreshCategories();else{a='<div class="inner-message alert alert-error" style="position: fixed;top: 40px;left: 50%;width: 40%;margin-left: -20%;" id="theid"><a class="fas fa-times message-close" onClick="removeMessagePopup(\'theid\');"></a><i class="fas fa-times-circle"></i>'+t.message+"</div>";$("#messages").append(a)}},error:function(){window.alert("Something went wrong while trying to reordering categories. Please try again.")}})}function hideReplies(){for(var e=document.getElementsByClassName("reply-box"),t=0;t<e.length;t++)e[t].style.display="none"}function deletePostToggle(e,t,a,r,s,i){if(checkAreYouSureForm()){var o=e?"0":"2",n=e?"delete":"undelete";if(window.confirm("Are you sure you would like to "+n+" this post?: \n\nWritten by:  "+r+"  @  "+s+"\n\nPlease note: The replies to this comment will also be "+n+"d. \n\nIf you are "+n+" the first post in a thread this will "+n+" the entire thread.")){var l=buildCourseUrl(["forum","posts","modify"])+`?modify_type=${o}`;$.ajax({url:l,type:"POST",data:{post_id:a,thread_id:t,csrf_token:i},success:function(e){try{var a=JSON.parse(e)}catch(e){var r='<div class="inner-message alert alert-error" style="position: fixed;top: 40px;left: 50%;width: 40%;margin-left: -20%;" id="theid"><a class="fas fa-times message-close" onClick="removeMessagePopup(\'theid\');"></a><i class="fas fa-times-circle"></i>Error parsing data. Please try again.</div>';return void $("#messages").append(r)}if("fail"!==a.status){var s="";switch(a.data.type){case"thread":default:s=buildCourseUrl(["forum","threads"]);break;case"post":s=buildCourseUrl(["forum","threads",t])}window.location.replace(s)}else r='<div class="inner-message alert alert-error" style="position: fixed;top: 40px;left: 50%;width: 40%;margin-left: -20%;" id="theid"><a class="fas fa-times message-close" onClick="removeMessagePopup(\'theid\');"></a><i class="fas fa-times-circle"></i>'+a.message+"</div>",$("#messages").append(r)},error:function(){window.alert("Something went wrong while trying to delete/undelete a post. Please try again.")}})}}}function alterAnnouncement(e,t,a,r){if(window.confirm(t)){var s=buildCourseUrl(["forum","announcements"])+`?type=${a}`;$.ajax({url:s,type:"POST",data:{thread_id:e,csrf_token:r},success:function(t){window.location.replace(buildCourseUrl(["forum","threads",e]))},error:function(){window.alert("Something went wrong while trying to remove announcement. Please try again.")}})}}function pinThread(e,t){var a=buildCourseUrl(["forum","threads","pin"])+`?type=${t}`;$.ajax({url:a,type:"POST",data:{thread_id:e,csrf_token:csrfToken},success:function(t){window.location.replace(buildCourseUrl(["forum","threads",e]))},error:function(){window.alert("Something went wrong while trying on pin/unpin thread. Please try again.")}})}function addMarkdownCode(e,t){var a=$(t).prop("selectionStart"),r=$(t).val(),s="";1==e?s="[display text](url)":0==e&&(s="```\ncode\n```"),$(t).val(r.substring(0,a)+s+r.substring(a))}function checkInputMaxLength(e){$(e).val().length==$(e).attr("maxLength")&&(alert("Maximum input length reached!"),$(e).val($(e).val().substr(0,$(e).val().length)))}function sortTable(e,t=!1){for(var a=document.getElementById("forum_stats_table"),r=!0;r;){r=!1;for(var s=a.getElementsByTagName("TBODY"),i=1;i<s.length-1;i++){var o=s[i].getElementsByTagName("TR")[0].getElementsByTagName("TD")[e],n=s[i+1].getElementsByTagName("TR")[0].getElementsByTagName("TD")[e];t?(0==e?o.innerHTML<n.innerHTML:parseInt(o.innerHTML)>parseInt(n.innerHTML))&&(s[i].parentNode.insertBefore(s[i+1],s[i]),r=!0):(0==e?o.innerHTML>n.innerHTML:parseInt(o.innerHTML)<parseInt(n.innerHTML))&&(s[i].parentNode.insertBefore(s[i+1],s[i]),r=!0)}}var l=a.getElementsByTagName("TBODY")[0].getElementsByTagName("TR")[0].getElementsByTagName("TD");for(i=0;i<l.length;i++){var c=l[i].innerHTML.indexOf(" ↓"),d=l[i].innerHTML.indexOf(" ↑");(c>-1||d>-1)&&(l[i].innerHTML=l[i].innerHTML.slice(0,-2))}l[e].innerHTML=t?l[e].innerHTML+" ↑":l[e].innerHTML+" ↓"}function loadThreadHandler(){$("a.thread_box_link").click(function(e){e.preventDefault();var t=this,a=$(t).attr("data"),r=buildCourseUrl(["forum","threads",a]);$.ajax({url:r,type:"POST",data:{thread_id:a,ajax:"true",csrf_token:csrfToken},success:function(e){try{var a=JSON.parse(e)}catch(e){var s='<div class="inner-message alert alert-error" style="position: fixed;top: 40px;left: 50%;width: 40%;margin-left: -20%;" id="theid"><a class="fas fa-times message-close" onClick="removeMessagePopup(\'theid\');"></a><i class="fas fa-times-circle"></i>Error parsing data. Please try again.</div>';return void $("#messages").append(s)}"fail"!==a.status?($(t).find(".thread_box").removeClass("new_thread"),$(".thread_box").removeClass("active"),$(t).children("div.thread_box").addClass("active"),$("#posts_list").empty().html(JSON.parse(a.data.html)),window.history.pushState({pageTitle:document.title},"",r),enableTabsInTextArea(".post_content_reply"),saveScrollLocationOnRefresh("posts_list"),$(".post_reply_from").submit(publishPost)):(s='<div class="inner-message alert alert-error" style="position: fixed;top: 40px;left: 50%;width: 40%;margin-left: -20%;" id="theid"><a class="fas fa-times message-close" onClick="removeMessagePopup(\'theid\');"></a><i class="fas fa-times-circle"></i>'+a.message+"</div>",$("#messages").append(s))},error:function(){window.alert("Something went wrong while trying to display thread details. Please try again.")}})})}function loadAllInlineImages(){$(".attachment-btn").each(function(){$(this).click()}),$(".attachment-well").each(function(){$(this).show()})}function loadInlineImages(e){var t=JSON.parse(e),a=$("#"+t[t.length-1]);if(a.is(":visible")?a.hide():a.show(),0===a.children().length)for(var r=0;r<t.length-1;r++){var s=t[r],i=s[0],o=$('<img src="'+i+'" alt="Click to view attachment in popup" title="Click to view attachment in popup" class="attachment-img">'),n=$("<p>"+escapeSpecialChars(decodeURI(s[2]))+"</p>");o.click(function(){var e=$(this).attr("src");window.open(e,"_blank","toolbar=no,scrollbars=yes,resizable=yes, width=700, height=600")}),a.append(o),a.append(n)}}var filters_applied=[];function clearForumFilter(){return checkUnread()&&$("#filter_unread_btn").click(),window.filters_applied=[],$("#thread_category button, #thread_status_select button").attr("btn-selected","false").removeClass("filter-active").addClass("filter-inactive"),$("#filter_unread_btn").removeClass("filter-active").addClass("filter-inactive"),$("#clear_filter_button").hide(),updateThreads(!0,null),!1}function loadFilterHandlers(){$("#filter_unread_btn").mousedown(function(e){$(this).toggleClass("filter-inactive filter-active")}),$("#thread_category button, #thread_status_select button").mousedown(function(e){e.preventDefault(),"true"===$(this).attr("btn-selected")?$(this).attr("btn-selected","false").removeClass("filter-active").addClass("filter-inactive"):$(this).attr("btn-selected","true").removeClass("filter-inactive").addClass("filter-active");var t=$(this).text();return window.filters_applied.toggleElement(t,function(e){return e===t}),0==window.filters_applied.length?clearForumFilter():$("#clear_filter_button").css("display","inline-block"),updateThreads(!0,null),!0}),$("#unread").change(function(e){return e.preventDefault(),updateThreads(!0,null),checkUnread(),!0})}function thread_post_handler(){$(".submit_unresolve").click(function(e){var t=$(this).attr("post_box_id");return $("#thread_status_input_"+t).val(-1),!0}),$(".post_reply_from").submit(function(){var e=$(this).find("[name=post]"),t=$(this).find("[name=post_and_unresolve]");return e.attr("disabled","true").val("Submitting post..."),t.attr("disabled","true").val("Submitting post..."),!0})}function forumFilterBar(){$("#forum_filter_bar").toggle()}function checkUnread(){return!!$("#unread").prop("checked")&&(unread_marked=!0,$("#filter_unread_btn").removeClass("filter-inactive").addClass("filter-active"),$("#clear_filter_button").css("display","inline-block"),!0)}Array.prototype.inArray||Object.defineProperty(Array.prototype,"inArray",{value:function(e){for(let t=0;t<this.length;t++)if(e(this[t]))return t;return!1}}),Array.prototype.toggleElement||Object.defineProperty(Array.prototype,"toggleElement",{value:function(e,t){var a=this.inArray(t);"boolean"==typeof a&&!a||"int"==typeof a&&0===a?this.push(e):this.splice(a,1)}});