var csrfToken=void 0;function buildUrl(e=[]){return document.body.dataset.baseUrl+e.join("/")}function buildCourseUrl(e=[]){return document.body.dataset.courseUrl+"/"+e.join("/")}function changeDiffView(e,a,r,t,n,o,s){var i="#"+e+"_1",l=$("#"+e+"_0").children()[0],d=$(i).children()[0],c={};if($("#"+s).empty(),"Visualize whitespace characters"==$("#show_char_"+n+"_"+o).text()){$("#show_char_"+n+"_"+o).removeClass("btn-default"),$("#show_char_"+n+"_"+o).addClass("btn-primary"),$("#show_char_"+n+"_"+o).html("Display whitespace/non-printing characters as escape sequences"),c.newline="&#9166;";var u="unicode"}else"Display whitespace/non-printing characters as escape sequences"==$("#show_char_"+n+"_"+o).text()?($("#show_char_"+n+"_"+o).html("Original View"),c.newline="\\n",u="escape"):($("#show_char_"+n+"_"+o).removeClass("btn-primary"),$("#show_char_"+n+"_"+o).addClass("btn-default"),$("#show_char_"+n+"_"+o).html("Visualize whitespace characters"),u="original");var p=buildCourseUrl(["gradeable",a,"grading","student_output","remove"])+`?who_id=${r}&version=${t}&index=${n}&autocheck_cnt=${o}&option=${u}&which=expected`;let m=function(e){return"fail"===e.status?(alert("Error loading diff: "+e.message),!1):"error"!==e.status||(alert("Internal server error: "+e.message),!1)};$.getJSON({url:p,success:function(e){if(m(e)){for(property in e.data.whitespaces)c[property]=e.data.whitespaces[property];$(d).empty(),$(d).html(e.data.html),p=buildCourseUrl(["gradeable",a,"grading","student_output","remove"])+`?who_id=${r}&version=${t}&index=${n}&autocheck_cnt=${o}&option=${u}&which=actual`,$.getJSON({url:p,success:function(e){if(m(e)){for(property in e.data.whitespaces)c[property]=e.data.whitespaces[property];for(property in c)$("#"+s).append('<span style="outline:1px blue solid;">'+c[property]+"</span> = "+property+" ");$(l).empty(),$(l).html(e.data.html)}},error:function(e){alert("Could not load diff, please refresh the page and try again.")}})}},error:function(e){alert("Could not load diff, please refresh the page and try again.")}})}function loadTestcaseOutput(e,a,r,t,n=""){let o=e;e="#"+e;let s=$("#tc_"+t).find(".loading-tools");if($(e).is(":visible"))$("#show_char_"+t).toggle(),$(e).empty(),toggleDiv(o),s.find("span").hide(),s.find(".loading-tools-show").show();else{$("#show_char_"+t).toggle();var i=buildCourseUrl(["gradeable",a,"grading","student_output"])+`?who_id=${r}&index=${t}&version=${n}`;s.find("span").hide(),s.find(".loading-tools-in-progress").show(),$.getJSON({url:i,success:function(a){"success"===a.status?($(e).empty(),$(e).html(a.data),toggleDiv(o),s.find("span").hide(),s.find(".loading-tools-hide").show()):alert("Error getting file diff: "+a.message)},error:function(e){alert("Could not load diff, please refresh the page and try again.")}})}}function newDeleteGradeableForm(e,a){$(".popup-form").css("display","none");var r=$("#delete-gradeable-form");$('[name="delete-gradeable-message"]',r).html(""),$('[name="delete-gradeable-message"]',r).append("<b>"+a+"</b>"),$('[name="delete-confirmation"]',r).attr("action",e),r.css("display","block")}function displayCloseSubmissionsWarning(e,a){$(".popup-form").css("display","none");var r=$("#close-submissions-form");$('[name="close-submissions-message"]',r).html(""),$('[name="close-submissions-message"]',r).append("<b>"+a+"</b>"),$('[name="close-submissions-confirmation"]',r).attr("action",e),r.css("display","block")}function newDeleteCourseMaterialForm(e,a){let r=buildCourseUrl(["course_materials","delete"])+"?path="+e;var t=window.pageYOffset;document.cookie="jumpToScrollPostion="+t,$("[id^=div_viewer_]").each(function(){var e=this.id.replace("div_viewer_","").trim();$("#div_viewer_"+e).hasClass("open")?document.cookie="cm_"+e+"=1;":document.cookie="cm_"+e+"=0;"}),$(".popup-form").css("display","none");var n=$("#delete-course-material-form");$('[name="delete-course-material-message"]',n).html(""),$('[name="delete-course-material-message"]',n).append("<b>"+a+"</b>"),$('[name="delete-confirmation"]',n).attr("action",r),n.css("display","block")}function newUploadImagesForm(){$(".popup-form").css("display","none");var e=$("#upload-images-form");e.css("display","block"),$('[name="upload"]',e).val(null)}function newUploadCourseMaterialsForm(){createArray(1);for(var e=document.getElementsByClassName("file-viewer-data"),a=[],r=0;r<e.length;r++){var t=e[r];a.push(t.getAttribute("data-file_url")),readPrevious(t.getAttribute("data-file_url"),1)}$(".popup-form").css("display","none");var n=$("#upload-course-materials-form");$('[name="existing-file-list"]',n).html(""),$('[name="existing-file-list"]',n).append("<b>"+JSON.stringify(a)+"</b>"),n.css("display","block"),$('[name="upload"]',n).val(null)}function setFolderRelease(e,a,r,t){$(".popup-form").css("display","none");var n=$("#set-folder-release-form");n.css("display","block"),$('[id="release_title"]',n).attr("data-path",e),$('[name="release_date"]',n).val(a),$('[name="release_date"]',n).attr("data-fp",e),t=JSON.stringify(t),$('[name="submit"]',n).attr("data-iden",r),$('[name="submit"]',n).attr("data-inDir",t)}function deletePlagiarismResultAndConfigForm(e,a){$(".popup-form").css("display","none");var r=$("#delete-plagiarism-result-and-config-form");$('[name="gradeable_title"]',r).html(""),$('[name="gradeable_title"]',r).append(a),$('[name="delete"]',r).attr("action",e),r.css("display","block")}function addMorePriorTermGradeable(e){var a=$("#save-configuration-form"),r=$('[name="prior_term_gradeables_number"]',a).val(),t='<br /><select name="prev_sem_'+r+'"><option value="">None</option>';$.each(e,function(e,a){t+='<option value="'+e+'">'+e+"</option>"}),t+='</select><select name="prev_course_'+r+'"><option value="">None</option></select><select name="prev_gradeable_'+r+'"><option value="">None</option></select>',$('[name="prev_gradeable_div"]',a).append(t),$('[name="prior_term_gradeables_number"]',a).val(parseInt(r)+1),$("select",a).change(function(){var a=$(this).attr("name");PlagiarismConfigurationFormOptionChanged(e,a)})}function setUserSubmittedCode(e,a){var r=$("#users_with_plagiarism"),t=$('[name="user_id_1"]',r).val();if(""==t)$('[name="version_user_1"]',r).find("option").remove().end().append('<option value="">None</option>').val(""),$('[name="user_id_2"]',r).find("option").remove().end().append('<option value="">None</option>').val(""),$('[name="code_box_1"]').empty(),$('[name="code_box_2"]').empty();else{var n=$('[name="version_user_1"]',r).val();if("version_user_1"==a&&""==n)$('[name="user_id_2"]',r).find("option").remove().end().append('<option value="">None</option>').val(""),$('[name="code_box_1"]').empty(),$('[name="code_box_2"]').empty();else{if("user_id_1"==a||"version_user_1"==a){""!=n&&"user_id_1"!=a||(n="max_matching");var o=buildCourseUrl(["plagiarism","gradeable",e,"concat"])+`?user_id_1=${t}&version_user_1=${n}`;$.ajax({url:o,success:function(e){if(e=JSON.parse(e),console.log(e.ci),e.error)alert(e.error);else{var a='<option value="">None</option>';for(var t in $.each(e.all_versions_user_1,function(r,t){t==e.active_version_user_1&&t==e.max_matching_version&&(a+='<option value="'+t+'">'+t+" (Active)(Max Match)</option>"),t==e.active_version_user_1&&t!=e.max_matching_version&&(a+='<option value="'+t+'">'+t+" (Active)</option>"),t!=e.active_version_user_1&&t==e.max_matching_version&&(a+='<option value="'+t+'">'+t+" (Max Match)</option>"),t!=e.active_version_user_1&&t!=e.max_matching_version&&(a+='<option value="'+t+'">'+t+"</option>")}),$('[name="version_user_1"]',r).find("option").remove().end().append(a).val(e.code_version_user_1),$(".CodeMirror")[0].CodeMirror.getDoc().setValue(e.display_code1),e.ci)for(var n in e.ci[t]){var o=e.ci[t][n];$(".CodeMirror")[t-1].CodeMirror.markText({line:o[1],ch:o[0]},{line:o[3],ch:o[2]},{attributes:{data_prev_color:o[4],data_start:o[7],data_end:o[8]},css:"border: 1px solid black; background: "+o[4]})}$(".CodeMirror")[0].CodeMirror.refresh()}},error:function(e){alert("Could not load submitted code, please refresh the page and try again.")}}),o=buildCourseUrl(["plagiarism","gradeable",e,"match"])+`?user_id_1=${t}&version_user_1=${n}`,$.ajax({url:o,success:function(e){if("no_match_for_this_version"==e){var a='<option value="">None</option>';$('[name="code_box_2"]').empty()}else{if((e=JSON.parse(e)).error)return void alert(e.error);a='<option value="">None</option>',$.each(e,function(e,r){a+='<option value="{&#34;user_id&#34;:&#34;'+r[0]+"&#34;,&#34;version&#34;:"+r[1]+'}">'+r[2]+" "+r[3]+" &lt;"+r[0]+"&gt; (version:"+r[1]+")</option>"})}$('[name="user_id_2"]',r).find("option").remove().end().append(a).val("")},error:function(e){alert("Could not load submitted code, please refresh the page and try again.")}}),$('[name="code_box_2"]').empty()}if("user_id_2"==a)if(""==$('[name="user_id_2"]',r).val())$('[name="code_box_2"]').empty(),o=buildCourseUrl(["plagiarism","gradeable",e,"concat"])+`?user_id_1=${t}&version_user_1=${n}&user_id_2=&version_user_2=`,$.ajax({url:o,success:function(e){if((e=JSON.parse(e)).error)alert(e.error);else{for(var a in $(".CodeMirror")[0].CodeMirror.getDoc().setValue(e.display_code1),e.ci)for(var r in e.ci[a]){var t=e.ci[a][r];$(".CodeMirror")[a-1].CodeMirror.markText({line:t[1],ch:t[0]},{line:t[3],ch:t[2]},{attributes:{data_start:t[7],data_end:t[8]},css:"border: 1px solid black; border-right:1px solid red;background: "+t[4]})}$(".CodeMirror")[0].CodeMirror.refresh()}},error:function(e){alert("Could not load submitted code, please refresh the page and try again.")}});else{var s=JSON.parse($('[name="user_id_2"]',r).val()).user_id,i=JSON.parse($('[name="user_id_2"]',r).val()).version;o=buildCourseUrl(["plagiarism","gradeable",e,"concat"])+`?user_id_1=${t}&version_user_1=${n}&user_id_2=${s}&version_user_2=${i}`,$.ajax({url:o,success:function(e){if((e=JSON.parse(e)).error)alert(e.error);else{for(var a in $(".CodeMirror")[0].CodeMirror.getDoc().setValue(e.display_code1),$(".CodeMirror")[1].CodeMirror.getDoc().setValue(e.display_code2),console.log(e.ci),e.ci)for(var r in e.ci[a]){var t=e.ci[a][r];$(".CodeMirror")[a-1].CodeMirror.markText({line:t[1],ch:t[0]},{line:t[3],ch:t[2]},{attributes:{data_start:t[7],data_end:t[8]},css:"border: 1px solid black; border-right:1px solid red;background: "+t[4]})}$(".CodeMirror")[0].CodeMirror.refresh(),$(".CodeMirror")[1].CodeMirror.refresh()}},error:function(e){alert("Could not load submitted code, please refresh the page and try again.")}})}}}}function getMatchesForClickedMatch(e,a,r,t,n,o,s,i,l){var d=$("#users_with_plagiarism"),c=$('[name="user_id_1"]',d).val(),u=$('[name="version_user_1"]',d).val();""!=$('[name="user_id_2"]',d).val()&&(JSON.parse($('[name="user_id_2"]',d).val()).user_id,JSON.parse($('[name="user_id_2"]',d).val()).version);var p=buildCourseUrl(["plagiarism","gradeable",e,"clicked_match"])+`?user_id_1=${c}&version_user_1=${u}&start=${r.line}&end=${t.line}`;$.ajax({url:p,success:function(c){if((c=JSON.parse(c)).error)alert(c.error);else if("code_box_2"==n){var u=$(s).attr("name"),p=-1;$('[name="code_box_2"]').find("span").each(function(){var e=$(this).attr("name");void 0!==e&&!1!==e&&e==u&&$(this).css("background-color","#FF0000")}),$('[name="code_box_1"]').find("span").each(function(){var e=$(this).attr("name");void 0!==e&&!1!==e&&(e=JSON.parse(e)).start==r&&e.end==t&&$(this).css("background-color","#FF0000")}),$('[name="code_box_1"]').scrollTop(0),p=0,$('[name="code_box_1"]').find("span").each(function(){if("rgb(255, 0, 0)"==$(this).css("background-color"))return p=$(this).offset().top-$('[name="code_box_1"]').offset().top,!1}),$('[name="code_box_1"]').scrollTop(p)}else if("code_box_1"==n){var m="";$.each(c,function(a,n){m+='<li class="ui-menu-item"><div tabindex="-1" class="ui-menu-item-wrapper" onclick=getMatchesForClickedMatch("'+e+'",event,'+r.line+","+t.line+',"popup","'+o+'","","'+n[0]+'",'+n[1]+");>"+n[3]+" "+n[4]+" &lt;"+n[0]+"&gt; (version:"+n[1]+")</div></li>"}),m=$.parseHTML(m),$("#popup_to_show_matches_id").empty().append(m);var f=a.pageX,_=a.pageY;$("#popup_to_show_matches_id").css("display","block");var h=$("#popup_to_show_matches_id").width();$("#popup_to_show_matches_id").css("top",_+5),$("#popup_to_show_matches_id").css("left",f-h/2)}else"popup"==n&&(jQuery.ajaxSetup({async:!1}),$('[name="user_id_2"]',d).val('{"user_id":"'+i+'","version":'+l+"}"),setUserSubmittedCode(e,"user_id_2"),$('[name="code_box_1"]').find("span").each(function(){var e=$(this).attr("name");void 0!==e&&!1!==e&&(e=JSON.parse(e)).start==r&&e.end==t&&$(this).css("background-color","#FF0000")}),$.each(c,function(e,a){a[0]==i&&a[1]==l&&$.each(a[2],function(e,a){$('[name="code_box_2"]').find("span").each(function(){var e=$(this).attr("name");void 0!==e&&!1!==e&&JSON.parse($(this).attr("name")).start==a.start&&JSON.parse($(this).attr("name")).end==a.end&&$(this).css("background-color","#FF0000")})})}),$('[name="code_box_2"]').scrollTop(0),p=0,$('[name="code_box_2"]').find("span").each(function(){if("rgb(255, 0, 0)"==$(this).css("background-color"))return p=$(this).offset().top-$('[name="code_box_2"]').offset().top,!1}),$('[name="code_box_2"]').scrollTop(p),jQuery.ajaxSetup({async:!0}))},error:function(e){alert("Could not load submitted code, please refresh the page and try again.")}})}function toggleUsersPlagiarism(e){var a=$("#users_with_plagiarism"),r=$('[name="user_id_1"]',a).val(),t=$('[name="version_user_1"]',a).val();if(""!=r&&""!=t&&""!=$('[name="user_id_2"]',a).val()){var n=JSON.parse($('[name="user_id_2"]',a).val()).user_id,o=JSON.parse($('[name="user_id_2"]',a).val()).version;$('[name="user_id_1"]',a).val(n),jQuery.ajaxSetup({async:!1}),setUserSubmittedCode(e,"user_id_1"),$('[name="version_user_1"]',a).val(o),setUserSubmittedCode(e,"version_user_1"),$('[name="user_id_2"]',a).val('{"user_id":"'+r+'","version":'+t+"}"),jQuery.ajaxSetup({async:!0}),setUserSubmittedCode(e,"user_id_2")}}function configureNewGradeableForPlagiarismFormOptionChanged(e,a){var r=$("#save-configuration-form");if("language"==a)"python"==$('[name="language"]',r).val()?$('[name="sequence_length"]',r).val("1"):"cpp"==$('[name="language"]',r).val()?$('[name="sequence_length"]',r).val("2"):"java"==$('[name="language"]',r).val()?$('[name="sequence_length"]',r).val("3"):"plaintext"==$('[name="language"]',r).val()&&$('[name="sequence_length"]',r).val("4");else if("prev_sem_"==a.substring(0,9)){var t=a.substring(9),n=$('[name="prev_sem_'+t+'"]',r).val();if($('[name="prev_gradeable_'+t+'"]',r).find("option").remove().end().append('<option value="">None</option>').val(""),$('[name="prev_course_'+t+'"]',r).find("option").remove().end().append('<option value="">None</option>').val(""),""!=n){var o="";$.each(e,function(e,a){n==e&&$.each(a,function(e,a){o+='<option value="'+e+'">'+e+"</option>"})}),$('[name="prev_course_'+t+'"]',r).find("option").remove().end().append('<option value="">None</option>'+o).val("")}}else if("prev_course_"==a.substring(0,12)){t=a.substring(12),n=$('[name="prev_sem_'+t+'"]',r).val();var s=$('[name="prev_course_'+t+'"]',r).val();$('[name="prev_gradeable_'+t+'"]',r).find("option").remove().end().append('<option value="">None</option>').val(""),""!=s&&(o="",$.each(e,function(e,a){n==e&&$.each(a,function(e,a){s==e&&$.each(a,function(e,a){o+='<option value="'+a+'">'+a+"</option>"})})}),$('[name="prev_gradeable_'+t+'"]',r).find("option").remove().end().append('<option value="">None</option>'+o).val(""))}}function copyToClipboard(e){var a=JSON.parse($("#download_info_json_id").val()),r=[];$("#download-form input:checkbox").each(function(){if($(this).is(":checked")){var t=$(this).val();if("instructor"===t)for(var n=0;n<a.length;++n)"Instructor"===a[n].group&&r.push(a[n].email);else if("full_access_grader"===t)for(n=0;n<a.length;++n)"Full Access Grader (Grad TA)"===a[n].group&&r.push(a[n].email);else if("limited_access_grader"===t)for(n=0;n<a.length;++n)"Limited Access Grader (Mentor)"===a[n].group&&r.push(a[n].email);else for(n=0;n<a.length;++n)"user"===e?a[n].reg_section===t&&r.push(a[n].email):"grader"===e&&("All"===a[n].reg_section&&r.push(a[n].email),-1!==$.inArray(t,a[n].reg_section.split(","))&&r.push(a[n].email))}}),r=$.unique(r);var t=$("<textarea></textarea>").text(r.join(","));$(document.body).append(t),t.select(),document.execCommand("copy"),t.remove(),setTimeout(function(){$("#copybuttonid").prop("value","Copied")},0),setTimeout(function(){$("#copybuttonid").prop("value","Copy Emails to Clipboard")},1e3)}function downloadCSV(e){var a=JSON.parse($("#download_info_json_id").val()),r="First Name,Last Name,User ID,Email,Registration Section,Rotation Section,Group\n",t=[];$("#download-form input:checkbox").each(function(){if($(this).is(":checked")){var n=$(this).val();if("instructor"===n)for(var o=0;o<a.length;++o)"Instructor"===a[o].group&&-1===$.inArray(a[o].user_id,t)&&(r+=[a[o].first_name,a[o].last_name,a[o].user_id,a[o].email,'"'+a[o].reg_section+'"',a[o].rot_section,a[o].group].join(",")+"\n",t.push(a[o].user_id));else if("full_access_grader"===n)for(o=0;o<a.length;++o)"Full Access Grader (Grad TA)"===a[o].group&&-1===$.inArray(a[o].user_id,t)&&(r+=[a[o].first_name,a[o].last_name,a[o].user_id,a[o].email,'"'+a[o].reg_section+'"',a[o].rot_section,a[o].group].join(",")+"\n",t.push(a[o].user_id));else if("limited_access_grader"===n)for(o=0;o<a.length;++o)"Limited Access Grader (Mentor)"===a[o].group&&-1===$.inArray(a[o].user_id,t)&&(r+=[a[o].first_name,a[o].last_name,a[o].user_id,a[o].email,'"'+a[o].reg_section+'"',a[o].rot_section,a[o].group].join(",")+"\n",t.push(a[o].user_id));else for(o=0;o<a.length;++o)"user"===e?a[o].reg_section===n&&-1===$.inArray(a[o].user_id,t)&&(r+=[a[o].first_name,a[o].last_name,a[o].user_id,a[o].email,'"'+a[o].reg_section+'"',a[o].rot_section,a[o].group].join(",")+"\n",t.push(a[o].user_id)):"grader"===e&&("All"===a[o].reg_section&&-1===$.inArray(a[o].user_id,t)&&(r+=[a[o].first_name,a[o].last_name,a[o].user_id,a[o].email,'"'+a[o].reg_section+'"',a[o].rot_section,a[o].group].join(",")+"\n",t.push(a[o].user_id)),-1!==$.inArray(n,a[o].reg_section.split(","))&&-1===$.inArray(a[o].user_id,t)&&(r+=[a[o].first_name,a[o].last_name,a[o].user_id,a[o].email,'"'+a[o].reg_section+'"',a[o].rot_section,a[o].group].join(",")+"\n",t.push(a[o].user_id)))}});var n=$('<a id="downloadlink"></a>'),o="data:text/csv;charset=utf-8,"+encodeURIComponent(r);n.attr("href",o),n.attr("download","submitty_user_emails.csv"),n.css("display","none"),$(document.body).append(n),$("#downloadlink")[0].click(),$("#downloadlink").remove()}function adminTeamForm(e,a,r,t,n,o,s,i){$(".popup-form").css("display","none");var l=$("#admin-team-form");l.css("display","block"),$("#admin-team-form-submit").prop("disabled",!1),$('[name="new_team"]',l).val(e),$('[name="reg_section"] option[value="'+r+'"]',l).prop("selected",!0),$('[name="rot_section"] option[value="'+t+'"]',l).prop("selected",!0),e?$('[name="num_users"]',l).val(3):e||$('[name="num_users"]',l).val(o.length+s.length+2);var d=$("#admin-team-title");d.empty();var c=$("#admin-team-members");c.empty();var u=$("#admin-team-history-title");u.empty();var p=$("#admin-team-history-left");p.empty();var m=$("#admin-team-history-right");m.empty(),c.append("Team Member IDs:<br />");var f=JSON.parse($("#student_full_id").val());if(e){$('[name="new_team_user_id"]',l).val(a),$('[name="edit_team_team_id"]',l).val(""),d.append("Create New Team: "+a),c.append('<input class="readonly" type="text" name="user_id_0" readonly="readonly" value="'+a+'" />');for(var _=1;_<3;_++)c.append('<input type="text" name="user_id_'+_+'" /><br />'),$('[name="user_id_'+_+'"]',l).autocomplete({source:f}),$('[name="user_id_'+_+'"]').autocomplete("option","appendTo",l);c.find('[name="reg_section"]').val(r),c.find('[name="rot_section"]').val(t)}else{for($('[name="new_team_user_id"]',l).val(""),$('[name="edit_team_team_id"]',l).val(a),d.append("Edit Team: "+a),_=0;_<o.length;_++)c.append('<input class="readonly" type="text" name="user_id_'+_+'" readonly="readonly" value="'+o[_]+'" />                 <input id="remove_member_'+_+'" class = "btn btn-danger" value="Remove" onclick="removeTeamMemberInput('+_+');"                 style="cursor:pointer; width:80px; padding-top:3px; padding-bottom:3px;" aria-hidden="true"></input><br />');for(_=o.length;_<o.length+s.length;_++)c.append('<input class="readonly" type="text" style= "font-style: italic; color:grey;" name="pending_user_id_'+_+'" readonly="readonly" value="Pending: '+s[_-o.length]+'" />                <input id="approve_member_'+_+'" class = "btn btn-success" type="submit" value="Accept" onclick="approveTeamMemberInput(this,'+_+');"                 style="cursor:pointer; width:80px; padding-top:3px; padding-bottom:3px;" aria-hidden="true"></input><br />');for(_=o.length+s.length;_<o.length+s.length+2;_++)c.append('<input type="text" name="user_id_'+_+'" /><br />'),$('[name="user_id_'+_+'"]',l).autocomplete({source:f}),$('[name="user_id_'+_+'"]').autocomplete("option","appendTo",l);if(0!=n){var h=n.team_history.length;u.append("Team History: "),p.append('<input class="readonly" type="text" style="width:100%;" name="team_formation_date_left" readonly="readonly" value="Team formed on: " /><br />'),m.append('<input class="readonly" type="text" style="width:100%;" name="team_formation_date_right" readonly="readonly" value="'+n.team_history[0].time+'" /><br />'),p.append('<input class="readonly" type="text" style="width:100%;" name="last_edit_left" readonly="readonly" value="Last edited on: " /><br />'),m.append('<input class="readonly" type="text" style="width:100%;" name="last_edit_date_right" readonly="readonly" value="'+n.team_history[h-1].time+'" /><br />');for(var v=0;v<=h-1;v++){if("admin_create"==n.team_history[v].action)for(_=0;_<o.length;_++)n.team_history[v].first_user!=o[_]&&n.team_history[v].added_user!=o[_]||(p.append('<input class="readonly" type="text" style="width:100%;" name="user_id_'+_+'_left" readonly="readonly" value="'+o[_]+' added on: " /><br />'),m.append('<input class="readonly" type="text" style="width:100%;" name="user_id_'+_+'_right" readonly="readonly" value="'+n.team_history[v].time+'" /><br />'));if("admin_add_user"==n.team_history[v].action)for(_=0;_<o.length;_++)n.team_history[v].added_user==o[_]&&(p.append('<input class="readonly" type="text" style="width:100%;" name="user_id_'+_+'_left" readonly="readonly" value="'+o[_]+' added on: " /><br />'),m.append('<input class="readonly" type="text" style="width:100%;" name="user_id_'+_+'_right" readonly="readonly" value="'+n.team_history[v].time+'" /><br />'));"admin_remove_user"==n.team_history[v].action&&(p.append('<input class="readonly" type="text" style="width:100%;"  readonly="readonly" value="'+n.team_history[v].removed_user+' removed on: " /><br />'),m.append('<input class="readonly" type="text" style="width:100%;"  readonly="readonly" value="'+n.team_history[v].time+'" /><br />'))}}}$(":text",l).change(function(){for(var e=!1,a=0;a<f.length;a++)if(f[a].value==$(this).val()){e=!0;break}e||""==$(this).val()?$(this)[0].setCustomValidity(""):$(this)[0].setCustomValidity("Invalid user_id");var r=!1;$(":text",l).each(function(){this.checkValidity()||(r=!0)}),r?$("#admin-team-form-submit").prop("disabled",!0):$("#admin-team-form-submit").prop("disabled",!1)});var g=e?3:o.length+2;c.append('<span style="cursor: pointer;" onclick="addTeamMemberInput(this, '+g+');"><i class="fas fa-plus-square" aria-hidden="true"></i>         Add More Users</span>')}function removeTeamMemberInput(e){var a=$("#admin-team-form");$('[name="user_id_'+e+'"]',a).removeClass("readonly").prop("readonly",!1).val(""),$("#remove_member_"+e).remove();var r=JSON.parse($("#student_full_id").val());$('[name="user_id_'+e+'"]',a).autocomplete({source:r})}function approveTeamMemberInput(e,a){var r=$("#admin-team-form");$("#approve_member_"+a).remove(),$('[name="pending_user_id_'+a+'"]',r).attr("name","user_id_"+a),$('[name="user_id_'+a+'"]',r).attr("style","font-style: normal;");var t=JSON.parse($("#student_full_id").val());$('[name="user_id_'+a+'"]',r).autocomplete({source:t})}function addTeamMemberInput(e,a){e.remove();var r=$("#admin-team-form");$('[name="num_users"]',r).val(parseInt($('[name="num_users"]',r).val())+1),$("#admin-team-members").append('<input type="text" name="user_id_'+a+'" /><br />         <span style="cursor: pointer;" onclick="addTeamMemberInput(this, '+(a+1)+');"><i class="fas fa-plus-square" aria-hidden="true"></i>         Add More Users</span>');var t=JSON.parse($("#student_full_id").val());$('[name="user_id_'+a+'"]',r).autocomplete({source:t})}function addCategory(e,a){e.remove();var r=$("#admin-team-form");$('[name="num_users"]',r).val(parseInt($('[name="num_users"]',r).val())+1),$("#admin-team-members").append('<input type="text" name="user_id_'+a+'" /><br />         <span style="cursor: pointer;" onclick="addTeamMemberInput(this, '+(a+1)+');"><i class="fas fa-plus-square" aria-hidden="true"></i>         Add More Users</span>');var t=JSON.parse($("#student_full_id").val());$('[name="user_id_'+a+'"]',r).autocomplete({source:t})}function importTeamForm(){$(".popup-form").css("display","none");var e=$("#import-team-form");e.css("display","block"),$('[name="upload_team"]',e).val(null)}function randomizeRotatingGroupsButton(){$(".popup-form").css("display","none"),$("#randomize-button-warning").css("display","block")}function togglePageDetails(){var e=document.getElementById("page-info");"block"===e.style.display?e.style.display="none":(e.style.display="block",document.body.addEventListener("mouseup",function a(r){e.contains(r.target)||(e.style.display="none",document.body.removeEventListener("mouseup",a,!1))}))}function removeMessagePopup(e){$("#"+e).fadeOut("slow",function(){$("#"+e).remove()})}function gradeableChange(e,a){e+=a.value,window.location.href=e}function versionChange(e,a){e+=a.value,window.location.href=e}function checkVersionChange(e,a){if(e>a){var r="The max late days allowed for this assignment is "+a+" days. ";return confirm(r+="You are not supposed to change your active version after this time unless you have permission from the instructor. Are you sure you want to continue?")}return!0}function checkTaVersionChange(){return confirm("You are overriding the student's chosen submission. Are you sure you want to continue?")}function checkVersionsUsed(e,a,r){return!((a=parseInt(a))>=(r=parseInt(r)))||confirm("Are you sure you want to upload for "+e+"? You have already used up all of your free submissions ("+a+" / "+r+"). Uploading may result in loss of points.")}function toggleDiv(e){return $("#"+e).toggle(),!0}function checkRefreshPage(e){setTimeout(function(){check_server(e)},1e3)}function check_server(e){$.get(e,function(a){a.indexOf("REFRESH_ME")>-1?location.reload(!0):checkRefreshPage(e)})}function checkRefreshLichenMainPage(e,a,r){setTimeout(function(){check_lichen_jobs(e,a,r)},5e3)}function check_lichen_jobs(e,a,r){$.get(e,function(t){var n=localStorage.getItem("last_data");"REFRESH_ME"===t?(n="REFRESH_ME",localStorage.setItem("last_data",n),window.location.href=buildCourseUrl(["plagiarism"])):"NO_REFRESH"===t&&"REFRESH_ME"===n?(n="NO_REFRESH",localStorage.setItem("last_data",n),window.location.href=buildCourseUrl(["plagiarism"])):checkRefreshLichenMainPage(e,a,r)})}function downloadFile(e,a){window.location=buildCourseUrl(["download"])+`?dir=${a}&path=${e}`}function downloadSubmissionZip(e,a,r=null,t=null){return window.location=buildCourseUrl(["gradeable",e,"download_zip"])+`?dir=submissions&user_id=${a}&version=${r}&origin=${t}`,!1}function downloadCourseMaterialZip(e,a){window.location=buildCourseUrl(["course_materials","download_zip"])+"?dir_name="+e+"&path="+a}function checkColorActivated(){var e=0,a="&&((%'%'BA\r";$(document.body).keyup(function r(t){(e=a.charCodeAt(e)===t.keyCode?e+1:0)===a.length&&(setInterval(function(){$("*").addClass("rainbow")},100),$(document.body).off("keyup",r))})}function changeColor(e,a){e.style.color=a}function openDiv(e){var a=$("#"+e);return a.hasClass("open")?(a.hide(),a.removeClass("open"),$("#"+e+"-span").removeClass("fa-folder-open").addClass("fa-folder")):(a.show(),a.addClass("open"),$("#"+e+"-span").removeClass("fa-folder").addClass("fa-folder-open")),!1}function openDivForCourseMaterials(e){var a=$("#div_viewer_"+e);return a.hasClass("open")?(a.hide(),a.removeClass("open"),$($($(a.parent().children()[0]).children()[0]).children()[0]).removeClass("fa-folder-open").addClass("fa-folder"),"closed"):(a.show(),a.addClass("open"),$($($(a.parent().children()[0]).children()[0]).children()[0]).removeClass("fa-folder").addClass("fa-folder-open"),"open")}function openAllDivForCourseMaterials(){var e=$("[id ^= 'div_viewer_']");return e.hasClass("open")?(e.hide(),e.removeClass("open"),$($($(e.parent().children()[0]).children()[0]).children()[0]).removeClass("fa-folder-open").addClass("fa-folder"),"closed"):(e.show(),e.addClass("open"),$($($(e.parent().children()[0]).children()[0]).children()[0]).removeClass("fa-folder").addClass("fa-folder-open"),"open")}function closeDivForCourseMaterials(e){var a=$("#div_viewer_"+e);return a.hide(),a.removeClass("open"),$($($(a.parent().children()[0]).children()[0]).children()[0]).removeClass("fa-folder-open").addClass("fa-folder"),"closed"}function openAllDivForCourseMaterials(){var e=$("[id ^= 'div_viewer_']");return e.hasClass("open")?(e.hide(),e.removeClass("open"),$($($(e.parent().children()[0]).children()[0]).children()[0]).removeClass("fa-folder-open").addClass("fa-folder"),"closed"):(e.show(),e.addClass("open"),$($($(e.parent().children()[0]).children()[0]).children()[0]).removeClass("fa-folder").addClass("fa-folder-open"),"open")}function openUrl(e){return window.open(e,"_blank","toolbar=no, scrollbars=yes, resizable=yes, width=700, height=600"),!1}function changeName(e,a,r,t){var n=e.getElementsByTagName("strong")[0];t="true"==t,icon=e.getElementsByClassName("fas fa-eye")[0],void 0==icon?(icon=e.getElementsByClassName("fas fa-eye-slash")[0],t&&(n.style.color="black",n.style.fontStyle="normal"),n.innerHTML=r,icon.className="fas fa-eye",icon.title="Show full user information"):(t&&(n.style.color="grey",n.style.fontStyle="italic"),n.innerHTML=a,icon.className="fas fa-eye-slash",icon.title="Hide full user information")}function openFrame(e,a,r){var t=$("#file_viewer_"+a);if(!t.hasClass("open")){var n="file_viewer_"+a+"_iframe";"pdf"===r.substring(r.length-3)?t.html("<iframe id='"+n+"' src='"+e+"' width='750px' height='1200px' style='border: 0'></iframe>"):t.html("<iframe id='"+n+"' onload='resizeFrame(\""+n+"\");' src='"+e+"' width='750px' style='border: 0'></iframe>"),t.addClass("open")}return t.hasClass("shown")?(t.hide(),t.removeClass("shown"),$($($(t.parent().children()[0]).children()[0]).children()[0]).removeClass("fa-minus-circle").addClass("fa-plus-circle")):(t.show(),t.addClass("shown"),$($($(t.parent().children()[0]).children()[0]).children()[0]).removeClass("fa-plus-circle").addClass("fa-minus-circle")),!1}function resizeFrame(e){var a=parseInt($("iframe#"+e).contents().find("body").css("height").slice(0,-2));document.getElementById(e).height=a>500?"500px":a+18+"px"}function batchImportJSON(e,a){$.ajax(e,{type:"POST",data:{csrf_token:a}}).done(function(e){window.alert(e),location.reload(!0)}).fail(function(){window.alert("[AJAX ERROR] Refresh page")})}function submitAJAX(e,a,r,t){$.ajax(e,{type:"POST",data:a}).done(function(e){try{"success"===(e=JSON.parse(e)).status?r(e):(console.log(e.message),t(),"error"===e.status&&window.alert("[SAVE ERROR] Refresh Page"))}catch(a){console.log(e),t(),window.alert("[SAVE ERROR] Refresh Page")}}).fail(function(){window.alert("[SAVE ERROR] Refresh Page")})}function getFileExtension(e){return e.substring(e.lastIndexOf(".")+1).toLowerCase()}function openPopUp(e,a,r,t,n){var o="container_"+r+"_"+t+"_"+n,s='<link rel="stylesheet" type="text/css" href="'+e+'" />';s+=a+document.getElementById(o).innerHTML,my_window=window.open("","_blank","status=1,width=750,height=500"),my_window.document.write(s),my_window.document.close(),my_window.focus()}function displayError(e){e='<div class="inner-message alert alert-error" style="position: fixed;top: 40px;left: 50%;width: 40%;margin-left: -20%;" id="theid"><a class="fas fa-times message-close" onClick="removeMessagePopup(\'theid\');"></a><i class="fas fa-times-circle"></i>'+e+"</div>",$("#messages").append(e),$("#messages").fadeIn("slow")}function enableTabsInTextArea(e){var a=$(e);a.on("input",function(){$(this).outerHeight(38).outerHeight(this.scrollHeight)}),a.trigger("input"),a.keydown(function(e){if(27==e.which){var a=$(":input").filter(":visible");return a.eq(a.index(this)+1).focus(),!1}if(!e.shiftKey&&9==e.keyCode){var r=this.value,t=this.selectionStart,n=this.selectionEnd;return this.value=r.substring(0,t)+"\t"+r.substring(n),this.selectionStart=this.selectionEnd=t+1,!1}})}function updateGradeOverride(e){var a=new FormData($("#gradeOverrideForm").get(0)),r=buildCourseUrl(["grade_override",$("#g_id").val(),"update"]);return $.ajax({url:r,type:"POST",data:a,processData:!1,cache:!1,contentType:!1,success:function(e){try{var a=JSON.parse(e)}catch(e){var r='<div class="inner-message alert alert-error" style="position: fixed;top: 40px;left: 50%;width: 40%;margin-left: -20%;" id="theid"><a class="fas fa-times message-close" onClick="removeMessagePopup(\'theid\');"></a><i class="fas fa-times-circle"></i>Error parsing data. Please try again.</div>';return void $("#messages").append(r)}if("fail"!==a.status)refreshOnResponseOverriddenGrades(a),$("#user_id").val(this.defaultValue),$("#marks").val(this.defaultValue),$("#comment").val(this.defaultValue),r='<div class="inner-message alert alert-success" style="position: fixed;top: 40px;left: 50%;width: 40%;margin-left: -20%;" id="theid"><a class="fas fa-times message-close" onClick="removeMessagePopup(\'theid\');"></a><i class="fas fa-check-circle"></i>Updated overridden Grades for '+a.data.gradeable_id+".</div>",$("#messages").append(r);else{r='<div class="inner-message alert alert-error" style="position: fixed;top: 40px;left: 50%;width: 40%;margin-left: -20%;" id="theid"><a class="fas fa-times message-close" onClick="removeMessagePopup(\'theid\');"></a><i class="fas fa-times-circle"></i>'+a.message+"</div>";$("#messages").append(r)}},error:function(){window.alert("Something went wrong. Please try again.")}}),!1}function loadOverriddenGrades(e){var a=buildCourseUrl(["grade_override",e]);$.ajax({url:a,success:function(e){try{var a=JSON.parse(e)}catch(e){var r='<div class="inner-message alert alert-error" style="position: fixed;top: 40px;left: 50%;width: 40%;margin-left: -20%;" id="theid"><a class="fas fa-times message-close" onClick="removeMessagePopup(\'theid\');"></a><i class="fas fa-times-circle"></i>Error parsing data. Please try again.</div>';return void $("#messages").append(r)}"fail"!==a.status?refreshOnResponseOverriddenGrades(a):(r='<div class="inner-message alert alert-error" style="position: fixed;top: 40px;left: 50%;width: 40%;margin-left: -20%;" id="theid"><a class="fas fa-times message-close" onClick="removeMessagePopup(\'theid\');"></a><i class="fas fa-times-circle"></i>'+a.message+"</div>",$("#messages").append(r))},error:function(){window.alert("Something went wrong. Please try again.")}})}function refreshOnResponseOverriddenGrades(e){$("#load-overridden-grades"),$("#my_table tr:gt(0)").remove();var a='<div class="option-title" id="title">Overridden Grades for '+e.data.gradeable_id+"</div>";$("#title").replaceWith(a),0===e.data.users.length?$("#my_table").append('<tr><td colspan="5">There are no overridden grades for this homework</td></tr>'):e.data.users.forEach(function(a){var r="<a onclick=\"deleteOverriddenGrades('"+a.user_id+"', '"+e.data.gradeable_id+"');\"><i class='fas fa-trash'></i></a>",t=["<tr><td>"+a.user_id,a.user_firstname,a.user_lastname,a.marks,a.comment,r+"</td></tr>"];$("#my_table").append(t.join("</td><td>"))})}function deleteOverriddenGrades(e,a){var r=buildCourseUrl(["grade_override",a,"delete"]);return window.confirm("Are you sure you would like to delete this entry?")&&$.ajax({url:r,type:"POST",data:{csrf_token:csrfToken,user_id:e},success:function(e){var a=JSON.parse(e);if("fail"!==a.status)r='<div class="inner-message alert alert-success" style="position: fixed;top: 40px;left: 50%;width: 40%;margin-left: -20%;" id="theid"><a class="fas fa-times message-close" onClick="removeMessagePopup(\'theid\');"></a><i class="fas fa-check-circle"></i>Overridden Grades deleted .</div>',$("#messages").append(r),refreshOnResponseOverriddenGrades(a);else{var r='<div class="inner-message alert alert-error" style="position: fixed;top: 40px;left: 50%;width: 40%;margin-left: -20%;" id="theid"><a class="fas fa-times message-close" onClick="removeMessagePopup(\'theid\');"></a><i class="fas fa-times-circle"></i>'+a.message+"</div>";$("#messages").append(r)}},error:function(){window.alert("Something went wrong. Please try again.")}}),!1}function toggleRegradeRequests(){var e=document.getElementById("regradeBoxSection");"block"===e.style.display?e.style.display="none":e.style.display="block"}function escapeSpecialChars(e){var a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return a[e]})}function escapeHTML(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function changePermission(e,a){let r=buildCourseUrl(["course_materials","modify_permission"])+"?filenames="+encodeURIComponent(e)+"&checked="+a;$.ajax({type:"POST",url:r,data:{fn:e,csrf_token:csrfToken},success:function(e){},error:function(e){alert("Encounter saving the checkbox state.")}})}function changeFolderPermission(e,a,r){let t=buildCourseUrl(["course_materials","modify_permission"])+"?filenames="+encodeURIComponent(e[0])+"&checked="+a;$.ajax({type:"POST",url:t,data:{fn:e,csrf_token:csrfToken},success:function(e){r&&r(e)},error:function(e){alert("Encounter saving the checkbox state.")}})}function handleTimeZones(e){var a=buildUrl(["server_time"]);$.get({url:a,success:function(a){var r=JSON.parse(a).data;r=new Date(parseInt(r.year),parseInt(r.month)-1,parseInt(r.day),parseInt(r.hour),parseInt(r.minute),parseInt(r.second));var t=new Date,n=Math.abs(r.valueOf()-t.valueOf());(n=n/1e3/60)>10&&($(".flatpickr-calendar").append("<p>Enter all times relative to the server timezone</p>"),$(".flatpickr-calendar").append("<p>Server timezone: "+e+"</p>"))},error:function(e){console.log("Error getting server time.")}})}function setNewDateTime(e,a){var r=$("#"+e).val();if(!1!==changeNewDateTime(a,r)){var t=buildUrl(["server_time"]);$.get({url:t,success:function(a){var t=JSON.parse(a).data;function n(e){return("0"+e).slice(-2)}var o=(t=new Date(parseInt(t.year),parseInt(t.month)-1,parseInt(t.day),parseInt(t.hour),parseInt(t.minute),parseInt(t.second))).getFullYear()+"-"+n(t.getMonth()+1)+"-"+n(t.getDate()),s=n(t.getHours())+":"+n(t.getMinutes())+":"+n(t.getSeconds()),i=o+" "+s,l=t.getFullYear()+10+"-"+n(t.getMonth()+1)+"-"+n(t.getDate())+" "+s,d=r;return new Date(d).getTime()<=new Date(i).getTime()?($("#"+e).css("backgroundColor",green),green):new Date(d).getTime()>=new Date(l).getTime()?($("#"+e).css("backgroundColor",red),red):($("#"+e).css("backgroundColor",yellow),yellow)},error:function(e){console.log("Error getting server time.")}})}}function setChildNewDateTime(e,a,r){var t;t=!1,t=changeFolderNewDateTime(e,a,function(e){e&&(t=!0,r&&r(t))})}function updateToServerTime(e){var a=buildUrl(["server_time"]);$.get({url:a,success:function(a){var r=JSON.parse(a).data;r=new Date(parseInt(r.year),parseInt(r.month)-1,parseInt(r.day),parseInt(r.hour),parseInt(r.minute),parseInt(r.second)),e.setDate(r,!0)},error:function(e){console.log("Error getting server time.")}})}function updateToTomorrowServerTime(e){var a=buildUrl(["server_time"]);$.get({url:a,success:function(a){var r=JSON.parse(a).data;r=new Date(parseInt(r.year),parseInt(r.month)-1,parseInt(r.day),parseInt(r.hour),parseInt(r.minute),parseInt(r.second)),nextDay=new Date(r),nextDay.setDate(r.getDate()+1),e.setDate(nextDay,!0)},error:function(e){console.log("Error getting server time.")}})}function changeNewDateTime(e,a,r){let t=buildCourseUrl(["course_materials","modify_timestamp"])+"?filenames="+encodeURIComponent(e)+"&newdatatime="+a;$.ajax({type:"POST",url:t,data:{fn:e,csrf_token:csrfToken},success:function(e){return"fail"===JSON.parse(e).status?(alert("ERROR: Invalid date."),!1):(r&&r(e),!0)},error:function(e){return alert("Encounter saving the NewDateTime."),!1}})}function changeFolderNewDateTime(e,a,r){let t=buildCourseUrl(["course_materials","modify_timestamp"])+"?filenames="+encodeURIComponent(e[0])+"&newdatatime="+a;$.ajax({type:"POST",url:t,data:{fn:e,csrf_token:csrfToken},success:function(e){return"fail"===JSON.parse(e).status?(alert("ERROR: Invalid date."),!1):(r&&r(e),!0)},error:function(e){return alert("Encounter saving the NewDateTime."),!1}})}function checkSidebarCollapse(){$(document.body).width()<1150?$("aside").toggleClass("collapsed",!0):$("aside").toggleClass("collapsed",!1)}function toggleSidebar(){var e=$("aside"),a=e.hasClass("collapsed");localStorage.sidebar=!a,e.toggleClass("collapsed",!a)}function checkBulkProgress(e){var a=buildCourseUrl(["gradeable",e,"bulk","progress"]);$.ajax({url:a,data:null,type:"GET",success:function(e){e=JSON.parse(e).data,updateBulkProgress(e.job_data,e.count)},error:function(e){console.log("Failed to check job queue")}})}function auto_grow(e){e.style.height="5px",e.style.height=e.scrollHeight+5+"px"}function resizeNoScrollTextareas(){$("textarea.noscroll").each(function(){auto_grow(this)})}window.addEventListener("load",function(){for(const e in document.body.dataset)window[e]=document.body.dataset[e]}),window.addEventListener("resize",checkSidebarCollapse),$(checkColorActivated),$(function(){""!==window.location.hash&&$(window.location.hash).offset().top>0&&$("html, body").animate({scrollTop:$(window.location.hash).offset().top-60},800),setTimeout(function(){$(".alert-success").fadeOut()},5e3)}),$.fn.isInViewport=function(){var e=$(this).offset().top,a=e+$(this).outerHeight(),r=$(window).scrollTop(),t=r+$(window).height();return e>r&&a<t},$(document).ready(function(){$('[data-toggle="tooltip"]').tooltip({position:{my:"right+0 bottom+0"},content:function(){return $("aside").hasClass("collapsed")?"Collapse Sidebar"===$(this).attr("title")?"Expand Sidebar":$(this).attr("title"):""}}),""!==localStorage.sidebar&&$("aside").toggleClass("collapsed","true"===localStorage.sidebar),$(document.body).resize(function(){checkSidebarCollapse()}),checkSidebarCollapse()});