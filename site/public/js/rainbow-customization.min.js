function ExtractBuckets(){var e=[];$("#buckets_used_list").find("li").each(function(t,s){e.push($(s).text())}),$("#generate_json").val(JSON.stringify(e)),$("#custom_form").submit()}function ClampPoints(e){e.value=Math.max(0,e.value)}function ExtractBucketName(e,t){var s,a=e.split("-"),n="";for(s=t;s<a.length;s++)s>t&&(n+="-"),n+=a[s];return n}function ClampPercent(e){e.value=Math.min(Math.max(e.value,0),100),UpdateUsedPercentage(),$("#config-percent-"+ExtractBucketName(e.id,1)).text(e.value+"%")}function UpdateUsedPercentage(){var e=0;$("input[id^='percent']").filter(function(){return"none"!==$(this).parent().css("display")}).each(function(){e+=parseFloat($(this).val())});var t=$("#used_percentage");t.text(e.toString()+"%"),e>100?t.css({color:"red","font-weight":"bold"}):t.css({color:"black","font-weight":""})}function UpdateVisibilityBuckets(){$("#buckets_available_list").find("input").each(function(){var e=ExtractBucketName($(this).attr("id"),1);$("#config-"+e).css("display","none")});var e=$("#buckets_used_list").find("input");if(0!==e.length){var t=ExtractBucketName(e.first().attr("id"),1);$("#config-"+t).prependTo("#config-wrapper").css("display","block"),e.each(function(){var e=ExtractBucketName($(this).attr("id"),1);console.log("prev_bucket: "+t+" bucket: "+e),e!==t&&($("#config-"+e).css("display","block"),$("#config-"+t).after($("#config-"+e)),t=e)})}}function getSection(){var e={};return $.each($("input[class='sections_and_labels']"),function(){var t=this.getAttribute("data-section").toString(),s=this.value;if(""===s)throw"All sections MUST have a label before saving";e[t]=s}),e}function getDisplayBenchmark(){var e=[];return $.each($("input[name='display_benchmarks']:checked"),function(){e.push($(this).val())}),e}function getGradeableBuckets(){var e=[];return $(".bucket_detail_div").each(function(){if("block"==$(this).css("display")){var t={},s=$("#"+this.id+" h3");s=s[0].innerHTML.toLowerCase(),t.type=s;var a=$("#config-count-"+s).val();t.count=parseInt(a);var n=$("#percent-"+s).val();n/=100,t.percent=n;var c=[];$("#gradeables-list-"+s+" li").each(function(){var e={},t=$(this).children();e.max=parseFloat(t[0].value),e.id=t[1].innerHTML,c.push(e)}),t.ids=c,e.push(t)}}),e}function getMessages(){var e=[],t=$("#cust_messages_textarea").val();return t&&e.push(t),e}function buildJSON(){let e={display_benchmark:getDisplayBenchmark(),section:getSection(),gradeables:getGradeableBuckets(),messages:getMessages()};return JSON.stringify(e)}function showLogButton(e){$("#show_log_button").show(),$("#save_status_log").empty(),$("#save_status_log").append("<pre>"+e+"</pre>")}function checkAutoRGStatus(){$.getJSON({type:"POST",url:buildCourseUrl(["reports","rainbow_grades_status"]),data:{csrf_token:csrfToken},success:function(e){"success"===e.status?($("#save_status").html("Rainbow grades successfully generated!"),showLogButton(e.data)):"fail"===e.status?($("#save_status").html("A failure occurred generating rainbow grades"),showLogButton(e.message)):($("#save_status").html("Internal Server Error"),console.log(e))},error:function(e){console.error("Failed to parse response from server: "+e)}})}function ajaxUpdateJSON(e,t){try{$("#save_status").html("Saving...");var s=buildCourseUrl(["reports","rainbow_grades_customization"]);$.getJSON({type:"POST",url:s,data:{json_string:buildJSON(),csrf_token:csrfToken},success:function(e){"success"===e.status?($("#save_status").html("Generating rainbow grades, please wait..."),checkAutoRGStatus()):"fail"===e.status?$("#save_status").html("A failure occurred saving customization data"):($("#save_status").html("Internal Server Error"),console.error(e.message))},error:function(e){console.error("Failed to parse response from server: "+e)}})}catch(e){$("#save_status").html(e)}}function displayChangeDetectedMessage(){$("#save_status").html('Changes detected, press "Save Changes" to save them.')}$(document).ready(function(){$("#display_benchmarks h2").click(function(){$("#display_benchmarks_collapse").toggle()}),$("#section_labels h2").click(function(){$("#section_labels_collapse").toggle()}),$("#gradeables h2").click(function(){$("#gradeables_collapse").toggle()}),$("#cust_messages h2").click(function(){$("#cust_messages_collapse").toggle()}),$("input[name*='display_benchmarks']").change(function(){displayChangeDetectedMessage()}),$("#cust_messages_textarea").on("change keyup paste",function(){displayChangeDetectedMessage()}),$(".sections_and_labels").on("change keyup paste",function(){displayChangeDetectedMessage()});var e=document.querySelector("#buckets_used_list");new MutationObserver(function(e){displayChangeDetectedMessage()}).observe(e,{attributes:!0,childList:!0,characterData:!0}),$("#show_log_button").click(function(){$("#save_status_log").toggle()})});