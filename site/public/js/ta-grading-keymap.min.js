var keymap=[],remapping={active:!1,index:0};function registerKeyHandler(e,t){e.originalCode=e.code,e.fn=t,null!==remapGetLS(e.name)&&(e.code=remapGetLS(e.name)),keymap.push(e)}function unregisterKeyHandler(e,t){for(var a=0;a<keymap.length;a++)keymap[a].code!==e&&keymap[a].fn!==t||(keymap.splice(a,1),a--)}function isSettingsVisible(){return $("#settings-popup").is(":visible")}function showSettings(){generateHotkeysList(),$("#settings-popup").show()}function hideSettings(){remapping.active||$("#settings-popup").hide()}function generateHotkeysList(){$("#hotkeys-list").replaceWith(Twig.twig({ref:"HotkeyList"}).render({keymap:keymap}))}function remapHotkey(e){if(!remapping.active){var t=$("#remap-"+e);t.text("Enter Key..."),remapping.active=!0,remapping.index=e,$(".remap-disable").attr("disabled","disabled"),$("#settings-close").attr("disabled","disabled"),t.attr("disabled",null),t.addClass("btn-success")}}function remapFinish(e,t){for(var a=0;a<keymap.length;a++)if(e!==a&&keymap[a].code===t){var i=$("#remap-"+e);return i.text("Enter Unique Key..."),i.addClass("btn-danger"),void i.removeClass("btn-success")}keymap[e].code=t,remapSetLS(keymap[e].name,t),remapping.active=!1,generateHotkeysList(),$(".remap-disable").attr("disabled",null),$("#settings-close").attr("disabled",null)}function remapUnset(e){remapFinish(e,keymap[e].originalCode)}function remapGetLS(e){var t=localStorage.getItem("keymap");if(null===t)return null;try{t=JSON.parse(t)}catch(e){return null}return t.hasOwnProperty(e)?t[e].code:null}function remapSetLS(e,t){var a=localStorage.getItem("keymap");if(null===a)a={};else try{a=JSON.parse(a)}catch(e){a={}}a.hasOwnProperty(e)||(a[e]={}),a[e].code=t,localStorage.setItem("keymap",JSON.stringify(a))}function eventToKeyCode(e){var t=e.code;return e.shiftKey&&"ShiftLeft"!==e.code&&"ShiftRight"!==e.code&&(t="Shift "+t),e.metaKey&&"MetaLeft"!==e.code&&"MetaRight"!==e.code&&(t="Meta "+t),e.ctrlKey&&"ControlLeft"!==e.code&&"ControlRight"!==e.code&&(t="Control "+t),e.altKey&&"AltLeft"!==e.code&&"AltRight"!==e.code&&(t="Alt "+t),t}window.onkeyup=function(e){if(remapping.active)return remapFinish(remapping.index,eventToKeyCode(e)),void e.preventDefault()},window.onkeydown=function(e){if(remapping.active)e.preventDefault();else if(!isSettingsVisible()&&"TEXTAREA"!==e.target.tagName&&("INPUT"!==e.target.tagName||"checkbox"===e.target.type)&&"SELECT"!==e.target.tagName)for(var t=eventToKeyCode(e),a=0;a<keymap.length;a++)keymap[a].code===t&&keymap[a].fn(e,keymap[a].options)},Twig.twig({id:"HotkeyList",href:"/templates/grading/settings/HotkeyList.twig",async:!0});